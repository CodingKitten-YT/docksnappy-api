version: '3.8'

services:
  pigallery:
    image: piwigo/pigallery:latest # Use the official PiGallery Docker image
    container_name: pigallery
    restart: unless-stopped
    ports:
      - "80:80" # Expose HTTP on host, default PiGallery port is 80
    volumes:
      - "./data:/var/lib/pigallery" # Path to your data, will be mounted to PiGallery's data directory
      - "./uploads:/var/www/html/galleries/uploads" # Path for user uploads, will be mounted to PiGallery's uploads directory
      - "./pigallery.ini:/var/www/html/config/conf.ini.php" # Path to your pigallery.ini config file, will be mounted to PiGallery's configuration directory
    environment:
      - PIGALLERY_DB_HOST=db
      - PIGALLERY_DB_NAME=pigallery
      - PIGALLERY_DB_USER=pigallery
      - PIGALLERY_DB_PASSWORD=pigallery
      - PIGALLERY_DB_PORT=3306 # MySQL default port
      - PIGALLERY_ADMIN_EMAIL=admin@example.com
      - PIGALLERY_ADMIN_USERNAME=admin
      - PIGALLERY_ADMIN_PASSWORD=adminpass
    depends_on:
      - db

  db:
    image: mysql:5.7
    container_name: pigallery_db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: pigallery
      MYSQL_USER: pigallery
      MYSQL_PASSWORD: pigallery
    volumes:
      - "./database:/var/lib/mysql" # Path to your database data, will be mounted to MySQL's data directory
    environment:
      MYSQL_DATA_DIR: /docker-entrypoint-initdb.d # Required for data persistence on volume mount changes
    ports:
      - "3306:3306" # Default MySQL port

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    restart: unless-stopped
    ports:
      - "8080:80" # Expose PHPMyAdmin on host for database management
    environment:
      PMA_ARBITRARY: 'true'
      MYSQL_ROOT_PASSWORD: rootpassword
    depends_on:
      - db

networks:
  default:
    external:
      name: piwigo_default_network # Use the same network as defined in other services if applicable