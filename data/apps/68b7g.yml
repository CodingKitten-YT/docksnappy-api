version: '3.8'

services:
  chirpy:
    image: chirpy/chirpy:latest  # Using the official Chirpy Docker image
    ports:
      - "5000:5000"  # Expose Chirpy's web server on host port 5000
    volumes:
      - "./data:/code/data"  # Mount a local data volume to store the database, etc.
      - "./chirpy:/code/chirpy"  # Mount the chirpy directory in the container to store user-generated content
    environment:
      - "DB_HOST=db"  # Set the database host to 'db' service
      - "DB_USER=chirpy"  # Database username
      - "DB_PASSWORD=chirpy"  # Database password
      - "DB_NAME=chirpy"  # Database name
      - "SECRET_KEY=secret"`# Secret key for Chirpy's session management
    depends_on:
      - db

  db:
    image: postgres:latest  # Using the official PostgreSQL Docker image
    environment:
      - "POSTGRES_DB=chirpy"  # Database name
      - "POSTGRES_USER=chirpy"  # Database username
      - "POSTGRES_PASSWORD=chirpy"  # Database password
    volumes:
      - "./db_data:/var/lib/postgresql/data"  # Mount a local db_data volume to store database data persistently