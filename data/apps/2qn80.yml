version: '3.8'

services:
  artalk:
    image: 'artalk/artalk:latest'
    container_name: artalk
    ports:
      - "80:80" # Map the public port 80 to internal port 80 of the app for HTTP access.
      - "443:443" # Map the public port 443 to internal port 443 of the app for HTTPS access (requires SSL setup).
    restart: unless-stopped
    environment:
      ARTALK_HOSTNAME: artalk.example.com # Set the hostname (replace with your domain or subdomain).
      ARTALK_PROTOCOL: http # Set to 'https' if you are using SSL.
      ARTALK_PORT: 80 # The port Artalk should listen on inside the container (http).
      ARTALK_ADMIN_USERNAME: admin # Admin user for Artalk (change to your preference).
      ARTALK_ADMIN_PASSWORD: password # Admin password for Artalk (change to your preference).
    volumes:
      - './data:/data' # Path where you want to store the database files.
      - './letters:/app/build/letters' # Path for user-uploaded letters (optional, if used by your theme).
      - './artalk.conf:/etc/nginx/conf.d/default.conf' # Optional: Custom Nginx configuration file.
    depends_on:
      - postgres

  postgres:
    image: 'postgres:13'
    container_name: artalk_postgres
    volumes:
      - './db:/var/lib/postgresql/data' # Path where you want to store the PostgreSQL data.
    environment:
      POSTGRES_DB: artalk # The name of the database Artalk will use.
      POSTGRES_USER: artalk # The username for the Artalk database.
      POSTGRES_PASSWORD: change_this # Change this to a strong password.
    restart: unless-stopped

  redis:
    image: 'redis:6'
    container_name: artalk_redis
    restart: unless-stopped

networks:
  default:
    drivers: overlay

# Uncomment the following if you need to use letters storage.
# volumes:
#   - './artalk_letters:/app/build/letters'