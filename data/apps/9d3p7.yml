version: '3.8'

services:
  countly-server:
    image: 'countly/community-edition:latest' # Use a specific tag if needed
    container_name: countly-server
    environment:
      COUNTLY_SECRET: "your_secret_key" # Replace with a strong secret key for security
      COUNTLY_DB_HOST: db
      COUNTLY_DB_NAME: countly
      COUNTLY_DB_USER: countly
      COUNTLY_DB_PASSWORD: countly_db_password # Replace with a strong password
      COUNTLY_ADMIN_EMAIL: admin@example.com # Replace with an email for admin account
      COUNTLY_ADMIN_PASSWORD: admin_password # Replace with a strong password
    ports:
      - "80:80" # HTTP port mapping
      - "443:443" # HTTPS port mapping (if you have SSL/TLS certificates)
    volumes:
      - ./countly-server/conf:/etc/count.super/conf.d
      - ./countly-server/logs:/var/log/countly
      - ./countly-server/data:/var/lib/countly
    depends_on:
      - db
    networks:
      - countly_net

  database:
    image: 'postgres:latest' # Use a specific tag if needed
    container_name: countly-db
    volumes:
      - ./countly-server/data/db:/var/lib/postgresql
    environment:
      POSTGRES_DB: countly
      POSTGES_USER: countly
      POSTGRES_PASSWORD: countly_db_password # Use the same password as specified in Countly
    networks:
      - countly_net

  redis:
    image: 'redis:latest' # Use a specific tag if needed
    container_name: countly-redis
    networks:
      - countly_net

networks:
  countly_net: