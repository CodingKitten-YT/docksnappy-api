version: '3.7'

services:
  leantime:
    image: leanlifter/leantime:latest # Use the official LeanTime image from Docker Hub
    container_name: leantime
    ports:
      - "80:3000" # Map port 3000 of the container to port 80 on the host for web access
    environment:
      - HOST=0.0.0.0
      - PORT=3000
      - DEFAULT_ADMIN_USER=admin@example.com
      - DEFAULT_ADMIN_PASSWORD=changeme
      # Uncomment the following line if you want to enable automatic creation of projects on startup
      # - AUTOMATIC_PROJECT_CREATION=true
    volumes:
      - leantime-data:/var/task
      - leantime-uploads:/usr/src/app/public/uploads
      - ./letsencrypt:/etc/letsencrypt
    networks:
      - leantime_network

  db:
    image: postgres:13 # Use PostgreSQL 13 as the database server
    container_name: leantime_db
    volumes:
      - leantime-db-data:/var/lib/postgresql2
    environment:
      POSTGRES_DB: leanlifter
      POSTGRES_USER: leanlifter
      POSTGRES_PASSWORD: changeit
    networks:
      - leantime_network

# Define named volumes for persistence
volumes:
  leantime-data:
  leantime-db-data:

# Define a network for the container to be part of
networks:
  leantime_network:
    driver: bridge

# Optionally, you can also set up a Let's Encrypt service to handle TLS certificates
services:
  letsencrypt:
    image: certbot/certbot-dns-lego
    volumes:
      - ./letsencrypt:/etc/letsencrypt
    entrypoint: /bin/sh -c 'trap exit TERM; while :; do lego renew --host="{{ .Hosts }}" && sleep 12h & wait $!; done;'

# Note: Ensure that you have the DNS configuration set up for domain validatio