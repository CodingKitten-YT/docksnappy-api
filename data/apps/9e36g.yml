version: '3'

services:
  db:
    image: postgres:latest
    command: >
      postgres -c 'fsync=off' -c 'full_page_writer=on' \
        -c 'wal_buffers=16MB' -c 'default_transaction_isolation=read committed' \
        -c 'max_connections=200'
    volumes:
      - 2fauth-db-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: 2fauth
      POSTGRES_USER: 2fauth
      POSTGRES_PASSWORD: secret
    restart: unless-stopped

  redis:
    image: redis:latest
    volumes:
      - 2fauth-redis-data:/data
    restart: unless-stopped

  web:
    image: jasper503/otp-2fauth:latest
    container_name: 2FAuth
    ports:
      - "80:80" # or another port you prefer, e.g., 8080
    environment:
      DATABASE_URL: postgres://2fauth:secret@db:5432/2fauth
      REDIS_HOST: redis
      REDIS_PORT: 6379
      SECRET_KEY: secretkeyforapp
      DEBUG: false
    depends_on:
      - db
      - redis
    restart: unless-stopped
    volumes:
      - ./static:/usr/src/app/static
      - ./templates:/usr/src/app/templates

volumes:
  2fauth-db-data:
  driver: local
  2fauth-redis-data:
  driver: local