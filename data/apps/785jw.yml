version: '3'
services:
  druid_broker:
    image: metamarkets/druid:v20230419CLS
    hostname: druid-broker
    ports:
      - "8081:8081" # HTTP endpoints and UI
      - "8181:8181" # Cluster Manager API
      - "8888:8888" # Broker Management API
    environment:
      DRUID_SECURITY_ENABLE_ADMIN_USER: "true"
      DRUID_BROKER_BOOTSTRAP_ZK_CONNECTION_STRING: "zookeeper:2181"
    depends_on:
      - druid_coordinator
      - druid_historical_nodes
      - druid_overlord
      - zookeeper

  druid_coordinator:
    image: metamarkets/druid:v20230419CLS
    hostname: druid-coordinator
    environment:
      DRUID_SECURITY_ENABLE_ADMIN_USER: "true"
      DRUID_COORDINATOR_BOOTSTRAP_ZK_CONNECTION_STRING: "zookeeper:2181"
    depends_on:
      - druid_broker
      - druid_historical_nodes
      - druid_overlord
      - zookeeper

  druid_historical_nodes:
    image: metamarkets/druid:v20230419CLS
    hostname: druid-historical-nodes
    environment:
      DRUID_SECURITY_ENABLE_ADMIN_USER: "true"
      DRUID_HISTORICAL_NODE_BOOTSTRAP_ZK_CONNECTION_STRING: "zookeeper:2181"
    depends_on:
      - druid_broker
      - druid_coordinator
      - druid_overlord
      - zookeeper

  druid_overlord:
    image: metamarkets/druid:v20230419CLS
    hostname: druid-overlord
    environment:
      DRUID_SECURITY_ENABLE_ADMIN_USER: "true"
      DRUID_OVERLORD_BOOTSTRAP_ZK_CONNECTION_STRING: "zookeeper:2181"
    depends_on:
      - druid_broker
      - druid_historical_nodes
      - zookeeper

  zookeeper:
    image: apache/zookeeper:latest
    hostname: zookeeper