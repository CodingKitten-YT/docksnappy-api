version: '3.8'

services:
  yb_feed:
    image: yb-feed:latest # Replace with the specific tag or commit you want to use
    command: serve
    restart: unless-stopped
    ports:
      - "8002:8002" # Expose the port on which ybFeed serves data
    environment:
      API_HOST: yb-master # Set the hostname for the API communication (assuming you have a yb-master service)
      PYTHONUNBUFFERED: true
    depends_on:
      - yb_master
      # Add other services that ybFeed depends on, like yb-tserver if needed

  yb_master:
    image: yb:latest # Replace with the specific tag or commit you want to use
    command: start-compact-rx-all --master-only
    restart: unless-stopped
    ports:
      - "8030:8030" # Expose the port for YugaByteDB master server (for monitoring, admin UI, etc.)
    environment:
      YOYO_MASTER_AUTOMIGRATE: "true"
      METRIC_REPORTER_ENABLED: "true"
      METRIC_REPORTER_PROMETHEUS_ENABLED: "true" # If you're using Prometheus for metrics collection
    depends_on:
      - yb-tools # Assuming yb-tools provides necessary tools like grafana and prometheus

  yb_tserver:
    image: yb:latest # Replace with the specific tag or commit you want to use
    command: start-compact-rx-all
    restart: unless-stopped
    ports:
      - "8101:8101" # Expose the port for YugaByteDB tiered server (for client connections, etc.)
    environment:
      YOYO_TSERVER_TABLETS_NUM_TABLETS: "4" # Adjust according to your requirements
      YOYO_MASTER_HOSTS: "${yb_master_1:8102}" # Reference the yb_master service
    depends_on:
      - yb_master

  yb_tools:
    image: yugabyte/yb-tools:latest # Replace with the specific tag or commit you want to use
    restart: unless-stopped
    volumes:
      - ./conf:/etc/yugabytedb:ro # Mount configuration files if you have any custom configs
    ports:
      - "9000:9000" # Expose Grafana port (for monitoring with Grafana)
      - "8001:8001" # Expose Prometheus port (for metrics collection)

volumes:
  ybdata: