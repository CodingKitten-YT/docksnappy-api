version: '3.8'

services:
  isso:
    image: "joelcalabre/isso:latest"  # Use the official image from Docker Hub
    container_name: "isso"
    command: -d --auth-method=token  # Run Isso in daemon mode and set authentication to token
    ports:
      - "3000:3000"  # Map the default port 3000 for the Isso web UI to the host
    volumes:
      - "./data:/code/data"  # Persist Isso data to a local directory (update path as needed)
      - "./isso-token.txt:/code/isso_token.txt"  # Store your authentication token (optional but recommended for security)
    environment:
      - AUTH_TOKEN=$(cat ./isso-token.txt)  # Set the authentication token from the file you created
    depends_on:
      - postgres  # Isso depends on a PostgreSQL database

  postgres:
    image: "postgres:latest"
    container_name: "postgres"
    volumes:
      - "./dbdata:/var/lib/postgresql/data"  # Persist the PostgreSQL data to a local directory (update path as needed)
    environment:
      POSTGRES_DB: isso  # Set the default database name for Isso
      POSTGRES_USER: isso  # Set the default PostgreSQL user for Isso
      POSTGRES_PASSWORD: change_this_password  # Set a password for the PostgreSQL user
    healthcheck:
      test: ["cmd", "sleep", "5", "&&", "pg_isready"]  # Ensure PostgreSQL is ready before other services start