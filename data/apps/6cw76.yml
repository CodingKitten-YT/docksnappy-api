version: '3.8'
services:
  mailhog:
    image: mailcow/mailhog:latest
    ports:
      - "8025:8025" # SMTP submission port
      - "1025:1025" # SMTP server port (MailHog listens to this for incoming mails)
      - "8000-8003:8000-8003" # Web UI ports
    volumes:
      - './mailhog/config:/data'
      - './mailhog/data:/var/spool/postfix'
    networks:
      - mailnet

  postfix:
    image: mailcow/postfix:latest
    environment:
      TZ: 'Europe/London' # Set your timezone accordingly
      POSTFIX_MAIN_IN_LOOPBACK: 'true'
      POSTFIX_INTERNET_MAY_PIPE_IN: 'true'
      MAILCOW_QUEUESMTP_HOST_OVERRIDE: 'mailhog:1025'
    depends_on:
      - mailhog
    volumes:
      - './mailhog/config:/data'
      - './mailhog/data:/var/spool/postfix'
    networks:
      - mailnet

  dovecot:
    image: mailcow/dovecot:latest
    depends_on:
      - postfix
    environment:
      TZ: 'Europe/London' # Set your timezone accordingly
      DOVECOT_LISTEN_ADDRESS: '0.0.0.0'
      DOVECOT_LOGLEVEL: 'DEBUG'
    volumes:
      - './mailhog/config:/data'
      - './mailhog/data:/var/spool/dovecot'
    networks:
      - mailnet

  squirrelmail:
    image: squirrelmail/squirrelmail:latest
    ports:
      - "2000:2000" # Web UI port
    volumes:
      - './mailhog/config:/data'
      - './mailhog/webui:/var/www/html'
    networks:
      - mailnet

  webapp:
    image: mailcow/mc-webapp:latest
    ports:
      - "3000:3000" # Web UI port
    depends_on:
      - postfix
      - dovecot
    volumes:
      - './mailhog/config:/data'
      - './mailhog/data:/var/spool/postfix'
      - './mailhog/letsencrypt:/etc/letsencrypt'
    networks:
      - mailnet

networks:
  mailnet:
    driver: bridge