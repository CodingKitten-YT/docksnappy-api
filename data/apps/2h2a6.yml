version: '3.7'

services:
  hortusfox:
    image: 'hortus/hortusfox:latest' # Use the official HortusFox image from Docker Hub
    container_name: hortusfox
    ports:
      - "5901:5901" # Expose the default port HortusFox uses for its web interface
    volumes:
      - type: bind
        source: ./hortusfox-data
        target: /var/lib/hortusfox
    environment:
      POSTGIS_DB: postgres # Name of the existing PostgreSQL database to connect to
      POSTGIS_USER: user # PostgreSQL username to connect with
      POSTGIS_PASSWORD: password # PostgreSQL password
    depends_on:
      - postgres

  postgres:
    image: 'postgres:13' # Use the official PostgreSQL image
    container_name: postgres
    volumes:
      - type: bind
        source: ./postgres-data
        target: /var/lib/postgresql/data
    environment:
      POSTGRES_DB: hortusfox # Name of the database to create for HortusFox
      POSTGRES_USER: user # Username for PostgreSQL
      POSTGRES_PASSWORD: password # Password for PostgreSQL
    init: true # Initialize the database when the container starts

# Optional volumes to persist data, make sure the host directories exist
volumes:
  hortusfox-data:
  postgres-data:

# Network setup (optional, default is fine for most setups)
networks:
  default:
    driver: bridge