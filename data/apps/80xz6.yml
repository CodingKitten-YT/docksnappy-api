version: '3'
services:
  registry:
    image: jarr/jarr:latest
    container_name: jarr-registry
    ports:
      - "5000:5000" # Default port for JARR Registry
    volumes:
      - "./data:/data" # Optional volume to persist data
    environment:
      REGISTRY_HTTP_TLS_SELF_SIGNED_CERTIFICATE: "false" # Set to 'true' if you want to use self-signed certificates
      REGISTRY_COMMON_REALM: "auth" # Authentication is enabled
      REGISTRY_AUTH_GITHUB_OAUTH_CLIENTID: "your_client_id" # If you enable GitHub login, set this
      REGISTRY_AUTH_GITHUB_SECRET: "your_secret_token" # If you enable GitHub login, set this
      REGISTRY_AUTH_ANONYMOUS_ enabled: "true" # Enable anonymous access without authentication
    command: "-v /data -S -b 0.0.0.0/0" # Start JARR with persistent storage and global accessibility

  # Optional logging service (if you want to keep logs)
  logzilla:
    image: logzilla/logzilla:latest
    container_name: logzilla
    volumes:
      - "./data/logzilla":/var/spool/logzilla
    command: "-f /dev/null" # Forward logs to Logzilla

  # Optional logging to a remote service like Loki (requires Logzilla with Loki receiver)
  loki-receiver:
    image: logzilla/loki-receiver:latest
    container_name: loki-receiver
    depends_on:
      - registry
    environment:
      LOCAL_WORKER_SECRET: "secret" # Set this to a secret for secure communication with Loki
    command: "-config.storage_path=/tmp/promtail -config.client_ssl_config={} -address 0" # Listen on all interfaces and forward logs to Loki

networks:
  jarr-network:
    driver: bridge