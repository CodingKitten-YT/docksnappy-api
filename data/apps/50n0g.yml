version: '3.8'

services:
  amusewiki:
    image: 'amusewiki/corephp:latest'
    container_name: amusewiki
    ports:
      - "8080:80" # HTTP port, default AmuseWiki port is 80
    volumes:
      - ./data/conf:/etc/amusewiki
      - ./data/uploads:/usr/src/uploads
      - ./data/instances/:/var/www/html
    environment:
      - DB_ENGINE=mysql
      - DB_SERVER=db
      - DB_NAME=amusewiki
      - DB_USER=your_database_user
      - DB_PASSWORD=your_database_password
      - ADMINS=admin@example.com
      # Set to true if you want to install the default extension packages, otherwise set to false
      - INSTALL_EXTENDS=false
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: 'mysql:5.7'
    container_name: amusewiki_db
    environment:
      MYSQL_ROOT_PASSWORD: your_root_password
      MYSQL_DATABASE: amusewiki
      MYSQL_USER: your_database_user
      MYQL_PASSWORD: your_database_password
    volumes:
      - ./data/db:/var/lib/mysql
    restart: unless-stopped

  php:
    image: 'php:7.4-fpm'
    container_name: amusewiki_php
    volumes:
      - ./data/conf:/etc/php
      - ./data/uploads:/usr/src/uploads
      - ./data/instances/:/var/www/html
    restart: unless-stopped

  nginx:
    image: 'nginx:latest'
    container_name: amusewiki_nginx
    ports:
      - "80:80" # HTTP port, default Nginx port is 80
      - "443:443" # HTTPS port, if you have SSL configured
    volumes:
      - ./data/conf:/etc/nginx
      - ./data/uploads:/usr/src/uploads
      - ./data/instances/:/var/www/html
    depends_on:
      - amusewiki
    restart: unless-stopped

networks:
  default:
    driver: bridge