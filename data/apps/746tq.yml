version: '3.8'

services:
  touca-agent:
    image: toucatech-io/touca-agent:latest
    command: agent -log.level debug
    environment:
      - TOUCA_AGENT_REMOTE_HOST=$TOUCA_AGENT_REMOTE_HOST
      # Set the following if you are running in a Kubernetes environment
      - KUBERNETES=true
      - SERVICE_ACCOUNT_ANONYMOUS=true
    ports:
      - "8080:8080"
    # The volume for storing Touca agent's configuration and secrets.
    volumes:
      - "./config:/config"
      - "./secrets:/secrets"
   # The host must be set to 0.0.0.0 to allow connections from the load balancer.
    networks:
      default:
        ipv4_address: 172.18.0.2

  touca-orchestrator:
    image: toucatech-io/touca-orchestrator:latest
    environment:
      - TOUCA_ORCHESTRATOR_AGENT_CONTAINER__image=toucatech-io/touca-agent:latest
      - TOUCA_ORCHESTRATOR_AGENT_CONTAINER__ports=8080
      - TOUCA_ORCHESTRATOR_AGENT_CONTAINER__environment.TOUCA_AGENT_REMOTE_HOST=$TOUCA_AGENT_REMOTE_HOST
    depends_on:
      - touca-agent
    networks:
      default:
        ipv4_address: 172.18.0.3

networks:
  default:
    external:
      name: nginx-loadbalancer # Assuming you have a load balancer named nginx-loadbalancer