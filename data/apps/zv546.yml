version: '3.8'

services:
  openeventserver:
    image: openevent/openevent-server:latest
    container_name: openeventserver
    ports:
      - "8001:8000" # HTTP API
      - "5672:5672"   # RabbitMQ admin interface (optional)
      - "8883:8883"   # MQTT broker (optional)
    volumes:
      - "./data/openeventserver:/opt/openevent/data"
    environment:
      OE_SECRET_KEY: "CHANGE_THIS_FOR_PRODUCTION"
      OE_POSTGRES_DB: "openevent"
      OE_POSTGRES_USER: "postgres"
      OE_POSTGRES_PASSWORD: "change_this_for_production"
      RABBITMQ_SERVER: "rabbitmqserver"
      MQTT_BROKER: "true"
      EMAIL_BACKEND: "djcelery"
      DEFAULT_FROM_EMAIL: "noreply@localhost.localdomain"
    depends_on:
      - postgres
      - rabbitmqserver
      - mqttbroker
      - sendmail
    networks:
      - openevent-network

  postgres:
    image: postgres:latest
    volumes:
      - "./data/postgres:/var/lib/postgresql/data"
    environment:
      POSTGRES_DB: "openevent"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "change_this_for_production"
    networks:
      - openevent-network

  rabbitmqserver:
    image: rabbitmq:latest
    volumes:
      - "./data/rabbitmq:/var/lib/rabbitmq"
    environment:
      RABBITMQ_SERVER: "true"
    networks:
      - openevent-network

  mqttbroker:
    image: eclipse-mosquitto:latest
    volumes:
      - "./data/mqttbroker:/var/lib/mosquitto"
    environment:
      MQTT_BROKER: "true"
    networks:
      - openevent-network

  sendmail:
    image: mailhog/mailhog:latest
    ports:
      - "8025:8025" # SMTP interface (web UI)
      - "9010:9010" # Admin API (optional)
    networks:
      - openevent-network

networks:
  openevent-network:
    driver: bridge