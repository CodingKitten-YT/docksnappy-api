version: '3.8'

services:
  mixpost:
    image: 'mixpost/mixpost:latest' # Use the official Mixpost image from Docker Hub
    ports:
      - "8080:8080" # Expose Mixpost UI on port 8080 of the host
    environment:
      - TZ=Europe/London # Set the timezone, change to your desired timezone
      - JWT_SECRET=very_secret_key # A secret key for JWT authentication
      - POSTGRES_DB=mixpost # Database name for PostgreSQL
      - POSTGRES_USER=mixpost # Username for PostgreSQL
      - POSTGRES_PASSWORD=mixpass # Password for PostgreSQL
    volumes:
      - ./data:/data # Persistent storage for Mixpost data (initially populate this directory)
    depends_on:
      - postgres  # Mixpost depends on the PostgreSQL service

  postgres:
    image: 'postgres:13' # Use PostgreSQL 13 image
    volumes:
      - ./data/postgres:/var/lib/postgresql/data # Persistent storage for PostgreSQL data
    environment:
      - POSTGRES_DB=mixpost # Database name for Mixpost
      - POSTGRES_USER=mixpost # Username for Mixpost's database access
      - POSTGRES_PASSWORD=mixpass # Password for Mixpost's database access
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mixpost"]
      timeout: 10s
      retries: 5

networks:
  default:
    driver: bridge