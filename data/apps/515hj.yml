version: '3.8'

services:
  komga:
    image: komga/komga:latest
    container_name: komga
    ports:
      - "80:80" # Expose Komga web UI on host port 80 (adjust as needed)
      - "9000:9000" # Komga admin interface (optional, for remote access)
    volumes:
      - "./komga-data:/data" # Path to your local storage (create a directory named komga-data)
      - "./komga-config:/config" # Path to your local config files (create a directory named komga-config)
    environment:
      KOMGA_DB_HOST: db
      KOMGA_DB_NAME: komga
      KOMGA_DB_USER: komga
      KOMGA_DB_PASSWORD: komgapassword
      KOMGA_ADMIN_EMAIL: admin@example.com
      KOMGA_ADMIN_PASSWORD: adminpassword
      JWT_SECRET: change_this_on_production
    depends_on:
      - db

  db:
    image: postgres:13
    container_name: komga-db
    volumes:
      - "./komga-data/db:/var/lib/postgresql"
    environment:
      POSTGRES_DB: komga
      POSTGRES_USER: komga
      POSTGRES_PASSWORD: komgapassword

  redis:
    image: redis:6-alpine
    container_name: komga-redis
    volumes:
      - "./komga-data/redis:/data"

# Optionally, you can also define a service for sending emails if you want Komga to send email notifications.
# email-service:
#   image: komga/email-service:latest
#   container_name: komga-email
#   environment:
#     EMAIL_USERNAME: your-email@example.com
#     EMAIL_PASSWORD: your-password
#   volumes:
#     - "./komga-data/email:/config"

networks:
  default:
    driver: bridge