version: '3.8'

services:
  liteshop:
    image: litecart/litecart:latest # You can also specify a specific version like litecart/litecart:15.9 if you want a stable release
    ports:
      - "80:80"
      - "443:443"
      - "21:21" # FTP port, if used by LiteCart
      - "22:22" # SSH port, for maintenance and management (optional)
    volumes:
      - liteshop-data:/var/www/html
      - liteshop-logs:/var/log/liteshop
    restart: unless-stopped
    environment:
      LC_USE_SSL.1: "1" # Enable SSL (HTTPS)
    depends_on:
      - php
      - mysql
      - redis

  php:
    image: litecart/litecart-php:latest # You can also specify a specific version like litecart/litecart-php:15.9
    volumes:
      - liteshop-data:/var/www/html
    restart: unless-stopped
    environment:
      JAVA_HOME: /usr/bin/java # Use this only if you need to specify JAVA_HOME, otherwise it's set automatically by the image

  mysql:
    image: mariadb:10.5
    command: --transaction-isolation=READ-COMMITTED
    volumes:
      - liteshop-db:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword # Replace 'rootpassword' with your actual password
      MYSQL_DATA: /var/lib/mysql
      MYSQL_USER: lcuser
      MYSQL_PASSWORD: lcpasswd # Replace 'lcpasswd' with your actual password
      MYSQL_DATABASE: liteshop
    restart: unless-stopped

  redis:
    image: redis:6.0-alpine
    volumes:
      - liteshop-redis:/data
    healthcheck:
      test: ["CMD", "REDIS-CLI", "PING"]
      timeout: 5s
      retries: 10
    restart: unless-stopped

  nginx-proxy:
    image: 'nginxproxy/nginx-proxy:alpine'
    depends_on:
      - liteshop
      - php
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - liteshop-data:/usr/share/nginx/html
      - nginx-conf.d:/etc/nginx/conf.d
      - letssl-data:/etc/letsencrypt
    restart: unless-stopped

  lettuce:
    image: letsencrypt/lettuce:latest
    volumes:
      - liteshop-db:/var/lib/mysql
      - letssl-data:/etc/letsencrypt
    depends_on:
      - mysql
    restart: unless-stopped

volumes:
  liteshop-data:
  liteshop-logs:
  liteshop-db:
  liteshop-redis:
  nginx-conf.d:
  letssl-data: