version: '3.8'
services:
  lynx:
    image: 'lynx/lynx:latest' # Use the official Lynx Docker image
    container_name: lynx
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/etc/google-cloud-keys.json # Mount your Google Cloud credentials here
    ports:
      - "5901:5901" # Lynx default port for the web UI
      # Optionally, expose the SSH port if you want to access the Lynx machine via SSH from the host
      - "2222:22"
    volumes:
      - ./lynx-config.yaml:/etc/lynx/config.yaml # Mount your custom Lynx configuration file
      - /var/run/docker.sock:/var/run/docker.sock:ro # Required for Docker client inside the container (if you use Lynx as a builder)
      - google-cloud-keys.json:/etc/google-cloud-keys.json # Mount your Google Cloud keys file to authenticate with GCP
    restart: unless-stopped
    capabilities_add:
      - SYS_ADMIN
    security_opt:
      - seccomp:unconfined

# Optional: If you want to use Lynx as a Docker image builder, uncomment the following section
# and adjust the `build_image` service accordingly.
services:
  build_image:
    build: .
    depends_on:
      - lynx
    volumes:
      - .:/app