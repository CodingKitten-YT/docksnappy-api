version: '3.8'
services:
  asciinema:
    image: asciinema/asciinema:latest
    container_name: asciinema
    ports:
      - "80:4000" # Expose the recording server on host port 80 (adjust as needed)
    volumes:
      - "./recordings:/recordings" # Path to store recordings on the host machine
      - "/var/run/docker.sock:/var/run/docker.sock" # Required for Docker access from inside the container
    environment:
      - ASCIINIMA_RECORDINGS="/recordings"
      - NODE_ENV=production
    command: record

  redis:
    image: redis:latest
    volumes:
      - "./data/redis:/data/redis" # Path to persist Redis data on the host machine (optional but recommended for data persistence)

  postgres:
    image: postgres:latest
    volumes:
      - "./data/postgres:/var/lib/postgresql/data" # Path to persist Postgres data on the host machine (optional but recommended for data persistence)
    environment:
      POSTGRES_DB: asciinema
      POSTGRES_USER: asciinema
      POSTGRES_PASSWORD: change_this_password # Set an appropriate password

networks:
  default:
    driver: bridge