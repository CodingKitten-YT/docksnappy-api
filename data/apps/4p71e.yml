version: '3.8'

services:
  chibisafe-web:
    image: chibisafe/chibisafe-web:latest
    ports:
      - "80:80" # HTTP port exposed to the host
      - "443:443" # HTTPS port exposed to the host
    depends_on:
      - chibisafe-db
    environment:
      - DB_HOST=chibisafe-db
      - DB_USER=<your_database_user>
      - DB_PASSWORD=<your_database_password>
      - DB_NAME=<your_database_name>
      - DB_PORT=5432  # PostgreSQL default port
      - SECRET_KEY=<secret_key>
    volumes:
      - ./config/chibisafe.conf:/etc/chibisafe/chibisafe.conf
      - chibisafe-web-data:/var/lib/tomcat9/webapps/ROOT/WEB-INF/classes
      - chibisafe-web-logs:/var/log/chibisafe-web

  chibisafe-db:
    image: postgres:13
    volumes:
      - chibisafe-db-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=<your_database_user>
      - POSTGRES_PASSWORD=<your_database_password>
      - POSTGRES_DB=<your_database_name>
      - POSTGRES_PORT=5432

  chibisafe-queue:
    image: rabbitmq:3-management
    ports:
      - "15672:15672" # RabbitMQ default port for connections
      - "5671:5671"   # RabbitMQ default port for client connections
      - "5672:5672"  # Management UI interface (optional)
    volumes:
      - chibisafe-queue-data:/var/lib/rabbitmq

volumes:
  chibisafe-web-data:
  chibisafe-db-data:
  chibisafe-queue-data: