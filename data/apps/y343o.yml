version: '3.8'

services:
  ocular:
    image: oculardata/ocular:latest
    container_name: ocular
    ports:
      - "5984:5984" # CouchDB (Ocular's underlying database) default port
    volumes:
      - "./data:/var/lib/ocular"
      - "./config/conf.json:/etc/ocular/conf.json" # Custom configuration file, if needed
      - "./plugins/:/var/lib/ocular/plugins" # Optional, for plugins that store state or files
    environment:
      - COUCHDB_USERNAME=admin
      - COUCHDB_PASSWORD=password
      - COUCHDB_ADMINSECURITY="true"
      - DB_TYPE=couchdb
    healthcheck:
      test: ["CMD-SHELL", "curl --fail http://localhost:5984/"]
      interval: 10s
      timeout: 5s
      retries: 30

  # Optional: CouchDB service if you want to run it separately
  couchdb:
    image: couchdb
    container_name: couchdb
    ports:
      - "5984:5984"
    volumes:
      - "./couchdb-data:/var/lib/couchdb"
    environment:
      - COUCHDB_USERNAME=admin
      - COUCHDB_PASSWORD=password
      - COUCHDB_ADMINSECURITY="true"

  # Optional: Redis if you decide to use it as the database instead of CouchDB
  redis:
    image: redis:latest
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - "./redis-data:/var/lib/redis"

networks:
  ocular_net:
    driver: bridge