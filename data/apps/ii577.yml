version: '3.7'

services:
  mira:
    image: mirtalk/miratalk-sfu:latest
    container_name: mirtalk-sfu
    ports:
      - "8080:8080" # HTTP UI
      - "3478:3478"  # WebSocket for signaling and media (required for SFU)
      - "10001:10001" # RTP/RTCP (if you need to expose RTSP/RTP streams)
    environment:
      MIRATALK_SECRET: "your_secret_here"
      MIRATALK_ACCESS_TOKEN_SECRET: "your_token_secret_here"
      MIRATALK_DB_HOST: db
      MIRATALK_DB_USERNAME: root
      MIRATALK_DB_PASSWORD: your_db_password_here
      MIRATALK_DB_DATABASE: miratalk_sfu
      MIRATALK_REDIS_HOST: redis
      MIRATALK_REDIS_PASSWORD: '' # If not using authentication for Redis
    volumes:
      - mirtalk-sfu-data:/data
    depends_on:
      - db
      - redis
      - nats_client

  db:
    image: postgres:12
    environment:
      POSTGRES_USER: root
      POSTGRES_PASSWORD: your_db_password_here
      POSTGRES_DB: miratalk_sfu
    volumes:
      - mirtalk-sfu-db:/var/lib/postgresql/data

  redis:
    image: redis:6-alpine
    command: redis-server --appendonly yes
    volumes:
      - mirtalk-sfu-redis:/data

  nats_client:
    image: nats:latest
    command: nc -m8 -srv842 -maxmem=100MB
    ports:
      - "4222:4222" # NATS Server Port
    volumes:
      - mirtalk-sfu-nats:/data

volumes:
  mirtalk-sfu-data:
  mirtalk-sfu-db:
  mirtalk-sfu-redis:
  mirtalk-sfu-nats: