version: '3.8'

services:
  maybe_gateway:
    image: stripe/stripe-clients-lib:0.9.2 # Maybe uses Stripe clients library
    command: /usr/local/bin/MaybeGateway
    ports:
      - "8080:8080"
    environment:
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      MAYBE_DATABASE_URL: ${POSTGRES_URL}
      MAYBE_REDIS_URL: ${REDIS_URL}
      MAYBE_ENVIRONMENT: production # or 'development', 'testing' depending on your setup
    depends_on:
      - maybe_postgres
      - redis
    volumes:
      - ./logs/maybe-gateway:/var/log/MaybeGateway

  maybe_postgres:
    image: postgres:13.2 # Use the PostgreSQL version compatible with Maybe
    environment:
      POSTGRES_DB: maybe
      POSTGRES_USER: maybeuser
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - ./data/maybe-postgres:/var/lib/postgresql/data

  redis:
    image: redis:6.0-alpine # Use the Redis version compatible with Maybe
    ports:
      - "6379:6379"

  maybe_worker:
    image: ghcr.io/maybecompany/maybe:production # Replace with the correct image tag
    command: worker
    environment:
      MAYBE_QUEUE: redis://redis:6379/0
      WORKERS: 2
      QUEUE_NAME: default
      MAYBE_ENVIRONMENT: production # or 'development', 'testing' depending on your setup
    depends_on:
      - maybe_postgres
      - redis

  maybe_api:
    image: ghcr.io/maybecompany/maybe:production # Replace with the correct image tag
    ports:
      - "4001:4001"
    environment:
      MAYBE_ENVIRONMENT: production # or 'development', 'testing' depending on your setup
      MAYBE_DATABASE_URL: ${POSTGRES_URL}
      MAYBE_REDIS_URL: ${REDIS_URL}
    depends_on:
      - maybe_postgres
      - redis
      - maybe_worker

caches:
  cache:
    enable: true
    pull: "always"

networks:
  default:
    driver: bridge