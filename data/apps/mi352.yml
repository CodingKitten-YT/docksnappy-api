version: '3.8'

services:
  motion:
    image: motion/motion:latest # or use a specific version tag if needed
    container_name: motion
    ports:
      - "8080:8080" # HTTP API port
      - "8672:8672" # Motion FFmpeg HTTP stream port
    volumes:
      - ./config:/etc/motion:ro # Mount your local configuration directory to the container (read-only)
      - /etc/passwd:/etc/passwd:ro # Required for some versions of Motion to access passwd database
      - ./videos:/var/lib/motion/videos # Storage location for recordings
      - ./cache:/var/lib/motion/cache # Cache for motion blobs (if used)
    environment:
      TZ: "Europe/Berlin" # Set your timezone, if necessary
      MOTION_ARGS: "-c /etc/motion/motion.conf -r 25 -s 300" # Custom Motion command line arguments
    restart: unless-stopped # Restart policy in case Motion crashes or the container is stopped

  nginx-proxy:
    image: 'nginx:stable'
    container_name: nginx-proxy
    ports:
      - "80:80" # Map HTTP port to the host
      - "443:443" # Map HTTPS port to the host (if using Let's Encrypt for SSL)
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d # Configuration for nginx
      - ./nginx/certs:/etc/nginx/ssl:ro # SSL certificates and keys (if using Let's Encrypt)
      - motion_proxy_log:/var/log/nginx # NGINX access and error logs
    networks:
      - webnet

  lettuce:
    image: letsencrypt/lettuce # This is an optional service for obtaining SSL certificates
    container_name: lettuce
    environment:
      EMAIL: your-email@example.com # Your email address for Let's Encrypt account recovery
    volumes:
      - ./nginx/certs:/etc/letsencrypt # Mount the path where SSL certificates will be stored
    depends_on:
      - nginx-proxy

volumes:
  motion_proxy_log:

networks:
  webnet: