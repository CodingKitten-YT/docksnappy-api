version: '3.8'

services:
  huly-web:
    image: huly/huly:latest  # Use the official or specific Huly image if available
    ports:
      - "80:80"  # Map HTTP port 80 on the host to port 80 in the container
      - "443:443"  # Map HTTPS port 443 on the host to port 443 in the container (if using SSL)
    depends_on:
      - huly-db
      - huly-redis
    environment:
      DATABASE_URL: "postgres://huly-db:5432"
      REDIS_URL: "redis://huly-redis:6379/0"
      SECRET_KEY: "your_secret_key"  # Replace with your actual secret key
    volumes:
      - ./data:/data  # Mount for static files, adjust path as needed
      - ./logs:/var/log/huly  # Logs directory (optional)
    restart: unless-stopped

  huly-db:
    image: postgres:13  # Use the PostgreSQL image and tag
    volumes:
      - huly-db-data:/var/lib/postgresql  # Persist database data
    environment:
      POSTGRES_DB: huly_production  # Database name
      POSTGRES_USER: huly  # Database user
      POSTGRES_PASSWORD: strong_password  # Database password
    restart: unless-stopped

  huly-redis:
    image: redis:6.2  # Use the Redis image and tag
    volumes:
      - huly-redis-data:/data  # Persist Redis data
    healthcheck:
      test: ["CMD", "REDITCLIA", "PING"]
      timeout: 5s
      retries: 10
    restart: unless-stopped

volumes:
  huly-db-data:
    driver: local
  huly-redis-data:
    driver: local