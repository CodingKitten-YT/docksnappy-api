version: '3.8'

services:
  hasura:
    image: hasurahq/tessellation:v2.0.16-engine
    container_name: hasura-tessellation
    ports:
      - "8080:8080" # The Hasura console UI exposing on this port
    environment:
      # Required for engine service to run. This can be set by passing it via CLI as well if needed.
      HASURA_GRAPHQL_ADMIN_SECRET: "random-secret" # Set your own secure secret
      HASURA_DB_ENGINE: "postgres"
      HASURA_DB_HOST: "db" # The service name of the db we define next
      HASURA_DB_USER: "yourusername" # db username, e.g., postgres for a PostgreSQL database
      HASURA_DB_PASSWORD: "yourpassword" # db password
      HASURA_DB_PORT: "5432" # db port, default for PostgreSQL
      HASURA_DB_SSL_MODE: "disable" # Set to 'require' if you want postgres to enforce SSL
      HASURA_DB_SSL_ROOT_CA: "" # If using SSL with a CA certificate this must be provided, otherwise omit
      HASURA_LOADER_SCHEMAS: "/path/to/your/schemas.yaml" # Optional - Location of your Hasura migration file
      HASURA_GRAPHQL_EXPOSE_UI: "true" # Expose Hasura Console UI via port mapping above
    depends_on:
      - db

  postgres:
    image: postgres:13-alpine
    container_name: hasura-postgres
    volumes:
      - "./data/postgres:/docker-entrypoint-initdb.d" # Optional - Use this to seed your database with SQL files on startup
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: "hasura"
      POSTGRES_USER: "yourusername"
      POSTGRES_PASSWORD: "yourpassword"
    ports:
      - "5432:5432" # PostgreSQL default port

volumes:
  postgres_data: