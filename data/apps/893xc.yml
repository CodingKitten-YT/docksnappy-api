version: '3.8'

services:
  centrifugo:
    image: centrifugo/centrifugo:latest # or use a specific tag if needed
    command: centrifugo -config /etc/centrifugo/upstream.yaml -dev
    ports:
      - "8080:8080" # HTTP API
      - "9090:9090" # WebSocket server port
    volumes:
      - ./data:/etc/centrifugo
      - ./configs:/etc/centrifugo/configs
    environment:
      CENTRIFUGO_SECRET: "your-secret-key"
      SERVICE_NAME: "your-service-name"
      SERVICE_ENVIRONMENT: "development" # or 'production', 'testing' etc.
    depends_on:
      - redis

  redis:
    image: redis:latest
    command: Redis --save . snapshot.tar.gz
    volumes:
      - ./data/redis:/data
    environment:
      - REDIS_REPLICATION=0 # or use 1 if you want to set up a master-slave configuration
    resource_limit:
      memory: 256M

  database:
    image: postgres:latest
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: centrifugo # default database name for Centrifugo
      POSTGRES_USER: centrifugo # default user for the database
      POSTGRES_PASSWORD: your-database-password # make sure to change this in production!
    resource_limit:
      memory: 256M

networks:
  centrifugo_net:
    driver: bridge