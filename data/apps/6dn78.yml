version: '3.8'

services:
  notify:
    image: homeassistant/hassio-addon:debian_buster
    container_name: github_notify
    ports:
      - "80:8123" # Expose Home Assistant frontend
      - "6360:6360" # MQTT broker (Optional, if you want to access it from the host)
      - "2685:2685" # Long Polling for Pushover, Pushbullet, etc. (Optional)
    volumes:
      - ./config:/config
    environment:
      - TZ=Europe/London
      - HOASSIO_CONFIG_REPO_GITHUB_WEBHOOKS=true # Enable GitHub webhooks
      - HOASSIO_CONFIG_REPO_GITHUB_SECRETS=true # Enable GitHub secrets
      - GH_TOKEN:${{ secrets.GITHUB_TOKEN }} # Use the GitHub token from Docker Compose secrets
    depends_on:
      - mqtt
    networks:
      - homeassistant

  mqtt:
    image: eclipse-mosquitto/mosquitto:latest
    container_name: github_mqtt
    volumes:
      - ./mqtt:/var/lib/mosquitto
    environment:
      MOSQUITTO_SERVER_ID: homeassistant_broker
      MOSQUITTO_PASSWORD:your_password # Set your MQTT password
    networks:
      - homeassistant

networks:
  homeassistant:
    driver: bridge