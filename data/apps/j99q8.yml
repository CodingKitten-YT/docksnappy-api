version: '3.8'
services:
  openproject:
    image: openproject/openproject:latest # or specify a particular version like openproject/openproject:EE-12.0.0
    container_name: openproject
    ports:
      - "9000:9000" # HTTP (Web UI)
      - "8080:8080" # AJP (Application Protocol/Java Servlet Pooling Protocol) for the underlying Tomcat server
      - "443:443"  # HTTPS (Secure Web UI, if you configure SSL/TLS)
    environment:
      OP_USE_EXTERNAL_URL: 'true' # If running behind a reverse proxy or load balancer
      JAVA_OPTS: "-Dserver.tomcat.port=8080 -Djavax.net.ssl.keyStore=/opt/openproject/data/ssl/keystore.jks -Djavax.net.ssl.keyStorePassword=your_password" # Configure as per your SSL setup
      OP_DB_DATABASE_HOST: db
      OP_DB_DATABASE_PORT: 5432
      OP_DB_DATABASE_USERNAME: postgres
      OP_DB_DATABASE_PASSWORD: postgres
      OP_DB_DATABASE_DBNAME: openproject
    volumes:
      - openproject-data:/opt/openproject/data # Persistent storage for OpenProject data (incl. attachments, plugins, etc.)
      - openproject-logs:/opt/openproject/logs  # Logs
      - openproject-conf:/opt/openproject/conf    # Configuration files (optional)
    depends_on:
      - db
    restart: unless-stopped

  db:
    image: postgres:latest
    container_name: openproject_db
    volumes:
      - openproject-data:/var/lib/postgresql
    environment:
      POSTGRES_DB: openproject
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    expose:
      - "5432"

volumes:
  openproject-data:
  openproject-logs:
  openproject-conf:

networks:
  default:
    driver: bridge