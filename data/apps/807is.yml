version: '3.8'
services:
  jitsi-container:
    image: jitsi/jitsi-meet:latest
    container_name: jitsi-meet
    ports:
      - "80:8443" # HTTP to WSS (WebSocket Secure)
      - "444:4443" # XMPP (for chat and file transfer)
    environment:
      JITSIT_AUTH_CONFIG: '{"users":[],"domain_options":{'stripped_of_extra_chars': true}'
      TZ: 'Europe/London' # Set your timezone, e.g., Europe/Paris, America/New_York, etc.
      JITSIPRESSO_USE_SSL: 'true'
    volumes:
      - jitsi-data:/var/lib/jitsi
      - jitsi-config:/var/lib/jitsi/config
    depends_on:
      - postgres
    networks:
      - jitsi-network

  postgres:
    image: postgres:latest
    volumes:
      - postgres-data:/var/lib/postgresql
    environment:
      POSTGRES_DB: jitsi
      POSTGRES_USER: jitsi
      POSTGES_PASSWORD: yourpassword
    networks:
      - jitsi-network

  mysql80:
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    volumes:
      - mysqldata:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpwd
      MYSQL_DATABASE: jitsi
      MYSQL_USER: jitsiuser
      MYSQL_PASSWORD: jitsipass
    networks:
      - jitsi-network

  monitoring:
    image: prom/prometheus:latest
    volumes:
      - prometheus-data:/data
    ports:
      - "9090:9090"
    networks:
      - jitsi-network

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - jitsi-network

  node_exporter:
    image: prometheus-community/node-exporter:latest
    volumes:
      - "/proseycs/lib/modules:/lib/modules"
      - "/proc:/proc"
      - "/sys:/sys"
    networks:
      - jitsi-network

  prometheus_config:
    image: prom/prometheus-config:latest
    volumes:
      - prometheus-data:/data
      - ./prometheus.yml:/etc/prometheus/conf.yaml
    depends_on:
      - monitoring
      - jitsi-meet

networks:
  jitsi-network:
    driver: bridge

volumes:
  jitsi-data:
  jitsi-config:
  postgres-data:
  mysqldata:
  prometheus-data:
  grafana-data: