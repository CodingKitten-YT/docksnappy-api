version: '3.8'

services:
  lodestone_app:
    image: lodestone/lodestone:latest  # Use the official Lodestone Docker image
    ports:
      - "8080:8080"  # Expose Lodestone on port 8080 of the host
    environment:
      LODESTONE_ENVIRONMENT: development  # Set the environment to 'development'
      JWT_SECRET: your_jwt_secret  # Replace with a strong, secret key for JWT tokens
      POSTGRES_HOST: db  # The database service name
      POSTGRES_DB: lodestone  # Database name for Lodestone
      POSTGRES_USER: lodestone  # Database user for Lodestone
      POSTGRES_PASSWORD: your_db_password  # Replace with a strong password for the database
    depends_on:
      - db
    volumes:
      - ./lodestone/data:/data  # Persist Lodestone data to a local directory

  postgres:
    image: postgres:13  # Use PostgreSQL 13 image
    environment:
      POSTGRES_DB: lodestone  # Database name for Lodestone
      POSTGRES_USER: lodestone  # Database user for Lodestone
      POSTGRES_PASSWORD: your_db_password  # Replace with a strong password for the database
    volumes:
      - postgres_data:/var/lib/postgresql  # Persist PostgreSQL data to a named volume

volumes:
  postgres_data: