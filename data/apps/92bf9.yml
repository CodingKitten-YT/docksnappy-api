version: '3.8'

services:
  teslamate:
    image: teslamate/teslamate:latest  # Use the official TeslaMate image
    container_name: teslamate
    environment:
      - TZ=Europe/London  # Set your timezone, e.g., Europe/London for UTC+1
      - NODE_ENV=production  # Run TeslaMate in production mode
      - POSTGRES_DB=teslamate  # Database name for PostgreSQL
      - POSTGRES_USER=teslamate  # Username for the PostgreSQL database
      - POSTGRES_PASSWORD=teslamate  # Password for the PostgreSQL database
      # Uncomment the following line if you want to enable Telegram integration
      # - TELEGRAM_TOKEN=your_bot_token  # Your bot token from BotFather in Telegram
    ports:
      - "5000:5000"  # Expose TeslaMate's web UI on port 5000 of the host
    volumes:
      - './teslamate:/data/teslamate'  # Mount your local TeslaMate directory to the container for data persistence
      - '/var/run/docker.sock:/var/run/docker.sock'  # Required for Docker API access
    restart: unless-stopped  # Restart the service if it stops (except when explicitly stopped)

  postgres:
    image: postgres:latest
    volumes:
      - './teslamate_pg:/var/lib/postgresql/data'  # Mount your local PostgreSQL data directory to the container for data persistence
    environment:
      - POSTGRES_DB=teslamate
      - POSTGRES_USER=teslamate
      - POSTGRES_PASSWORD=teslamate
    restart: unless-stopped

networks:
  teslamate_network:
    driver: bridge