version: '3.8'

services:
  ghostfolio:
    image: ghostfolio/ghostfolio:latest  # Use the official Ghostfolio Docker image
    container_name: ghostfolio
    restart: unless-stopped
    environment:
      - DB_HOST=db
      - REDIS_HOST=redis
      - VUE_ENV=production
      - DEBUG=false
    ports:
      - "3000:3000"  # Ghostfolio web interface
    depends_on:
      - db
      - redis
      - certbot
    volumes:
      - "./config/ghostfolio.json:/usr/src/app/ghostfolio.json"  # Your Ghostfolio configuration file
      - ghostfolio-data:/usr/src/app/data
      - ghostfolio-public:/usr/src/app/public

  db:
    image: postgres:latest
    environment:
      - POSTGRES_DB=ghostfolio
      - POSTGRES_USER=ghostfolio
      - POSTGRES_PASSWORD=ghostfolio
    volumes:
      - ghostfolio-db:/var/lib/postgresql/data
    restart: unless-stopped

  redis:
    image: redis:latest
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    restart: unless-stopped

  certbot:
    image: certbot/certbot:latest
    container_name: certbot
    volumes:
      - "./letsencrypt:/etc/letsencrypt"
    restart: unless-stopped

volumes:
  ghostfolio-data:
  ghostfolio-public:
  ghostfolio-db:
  redis-data:

networks:
  default:
    driver: bridge