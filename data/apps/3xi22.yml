version: '3.8'

services:
  actualapi:
    image: actualinc/actual:latest # Use the official Actual API Docker image
    container_name: actualapi
    ports:
      - "9090:9090" # Expose the port Actual API uses, default is 9090
    environment:
      AUTH_SECRET: random-secret-string # Replace with a secure, randomly generated string for authentication
      DATABASE_URL: postgres://user:password@db:5432/dbname # Database connection string
    depends_on:
      - db
    networks:
      - actualnetwork

  actual-worker:
    image: actualinc/actual:latest # Use the official Actual Worker Docker image
    container_name: actual-worker
    environment:
      AUTH_SECRET: same-as-api # Ensure this matches the API's AUTH_SECRET for authentication
      WORKER_ID: unique-worker-id # Unique identifier for the worker service within your setup
    depends_on:
      - actualapi
    networks:
      - actualnetwork

  postgres:
    image: postgres:13 # Use a specific version of PostgreSQL
    container_name: postgres
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: dbname
    volumes:
      - pgdata:/var/lib/postgresql/data # Persist database data to a named volume

volumes:
  pgdata:

networks:
  actualnetwork: