version: '3.8'

services:
  actualserver:
    image: actual_server
    container_name: actual-server
    environment:
      JVM_OPTIONS: '-Xms512M -Xmx512M'
      SERVER_HOST_WHITELIST: "^(localhost|127.0.0.1)$" # Adjust as needed for your network
      POSTGRES_DB: actual
      POSTGRES_USER: actual
      POSTGRES_PASSWORD: actual
    ports:
      - "8080:8080" # Actual server web UI
    depends_on:
      - postgres
    volumes:
      - ./data/actualserver:/data/actualserver

  postgres:
    image: postgres:13
    container_name: actual-db
    environment:
      POSTGRES_DB: actual
      POSTGRES_USER: actual
      POSTGRES_PASSWORD: actual
    volumes:
      - ./data/postgres:/var/lib/postgresql/data

  actualbackup:
    image: backup-task-copy
    container_name: actual-backup
    depends_on:
      - actualserver
    volumes:
      - ./data/actualserver:/data/actualserver
      - ./backups:/backups
    entrypoint: /bin/sh -c "trap exit TERM; while :; do backupdb postgres actual actual && sleep 12h & wait $${!}; done;"

networks:
  default:
    driver: bridge