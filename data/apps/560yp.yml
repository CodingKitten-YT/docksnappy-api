version: '3.8'

services:
  bar_assistant_api:
    image: "barassistant/api:latest"
    ports:
      - "5000:5000"
    command: api
    depends_on:
      - db
    environment:
      - DB_HOST=db
      - DB_USER=baruser
      - DB_PASSWORD=barpassword
      - DB_NAME=bardatabase
    expose:
      - "5000"

  bar_assistant_worker:
    image: "barassistant/worker:latest"
    depends_on:
      - mqtt
    environment:
      - MQTT_HOST=mqtt
      - MQTT_PORT=1883
      - WORKER_QUEUE_NAME=barqueue
    expose:
      - "5001"

  bar_assistant_frontend:
    image: "barassistant/frontend:latest"
    ports:
      - "80:80"
    depends_on:
      - api
    environment:
      - REACT_APP_API_URL=http://api:5000

  db:
    image: "postgres:13"
    volumes:
      - "./dbdata:/var/lib/postgresql/data"
    environment:
      - POSTGRES_USER=baruser
      - POSTGRES_PASSWORD=barpassword
      - POSTGRES_DB=bardatabase

  mqtt:
    image: "eaboute/mosquitto:latest"
    volumes:
      - "./mqttdata:/var/lib/mosquitto"