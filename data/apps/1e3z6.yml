version: '3.8'

services:
  trilium:
    image: triluim/trilium:latest
    container_name: trilium_notes
    command: -d --data-dir /data
    volumes:
      - "./config:/code/.config/trilium"
      - "./notes:/code/data"
    ports:
      - "9021:9021" # HTTP API server
      - "8021:8021" # Web interface
    environment:
      TRILIUM_ALLOW_USER_REGISTRATION: "false"
      JWT_SECRET: "your_jwt_secret" # Set this to a secure, random secret for JWT tokens
      LOGS_LEVEL: "info" # Can be debug, info, warn, error
    networks:
      - trilium_network

  postgres:
    image: postgres:latest
    volumes:
      - "./db_data:/var/lib/postgresql/data"
    environment:
      POSTGRES_DB: trilium
      POSTGRES_USER: trilium
      POSTGRES_PASSWORD: trilium
    networks:
      - trilium_network

networks:
  trilium_network:
    driver: bridge