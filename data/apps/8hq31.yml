version: '3.8'

services:
  dreamfactory:
    image: dreamfactory/dreamfactory:latest # Use a specific tag if needed
    container_name: dreamfactory
    ports:
      - "8085:80" # HTTP
      - "8443:443" # HTTPS (optional, requires SSL)
    environment:
      - DF_SECRET=secret_key # Set a secret key for your installation
      - DF_ALLOWED_HOSTS=* # Allow all hosts; use specific hostnames or IPs in production
      # Additional settings like database configuration, SMTP server settings, etc.
    volumes:
      - ./dreamfactory-data:/var/lib/dreamfactory # Mount for user data and attachments
      - ./conf.d:/etc/dreamfactory/conf.d       # Mount for custom configurations (optional)
      - ./logs:/var/log/dreamfactory            # Mount for logs (optional)
    networks:
      - dreamfactory_network

  database:
    image: postgres:12                        # Use a specific PostgreSQL version if needed
    container_name: dreamfactory_db
    volumes:
      - ./dreamfactory-data/db:/var/lib/postgresql # Persist database data
    environment:
      - POSTGRES_DB=dreamfactory     # Database name
      - POSTGRE_USER=dreamfactory     # Database user
      - POSTGRES_PASSWORD=db_secret  # Database password (should be securely managed)
    networks:
      - dreamfactory_network

  redis:
    image: redis:6-alpine                     # Use a specific Redis version if needed
    container_name: dreamfactory_redis
    volumes:
      - ./dreamfactory-data/redis:/data     # Persist Redis data
    networks:
      - dreamfactory_network

  nginx_proxy:
    image: jwilder/nginx-proxy:stable
    container_name: dreamfactory_nginx_proxy
    ports:
      - "80:80" # NGINX HTTP (optional, if you want to use NGINX Proxy)
      - "443:443" # NGINX HTTPS (optional, if you want to use Let's Encrypt with NGINX Proxy)
    depends_on:
      - dreamfactory
    networks:
      - dreamfactory_network

  letsencrypt:
    image: jrcss/letsencrypt-nginx-proxy-companion:latest
    container_name: dreamfactory_letscencrypt
    volumes:
      - ./letsencrypt:/etc/letsencrypt       # Mount for Let's Encrypt certificates (optional)
    depends_on:
      - nginx_proxy
    networks:
      - dreamfactory_network

networks:
  dreamfactory_network:
    driver: bridge