version: '3.8'
services:
  eclipse-che-lb:
    image: eclipse/che:1.10.4 # Use the desired version of Eclipse Che
    ports:
      - "8080:8080" # HTTP(S) proxy port
    networks:
      - che
    depends_on:
      - eclipse-che-server
      - eclipse-che-analytics
      - eclipse-che-postgresql
    command: >
      ./gradlew bootstrapServerWithMetricsAndHealthChecks
      ./gradlew startServerWithMetricsAndHealthChecks

  eclipse-che-server:
    image: eclipse/che:1.10.4 # Use the desired version of Eclipse Che
    environment:
      - JAVA_TOOL_OPTIONS=-Xms512M -Xmx512M -XX:+UseG1GC
    ports:
      - "8090:8090" # Remote workspace server port
    networks:
      - che
    depends_on:
      - eclipse-che-postgresql
    command: >
      ./gradlew bootstrapWorkspaceServerWithMetricsAndHealthChecks
      ./gradlew startWorkspaceServerWithMetricsAndHealthChecks

  eclipse-che-analytics:
    image: eclipse/che-analytics:1.10.4 # Use the desired version of Eclipse Che Analytics
    environment:
      - JAVA_TOOL_OPTIONS=-Xms256M -Xmx512M
    ports:
      - "8100:8100" # Prometheus port for metrics collection
    networks:
      - che
    depends_on:
      - eclipse-che-server

  eclipse-che-postgresql:
    image: postgres:12.3 # Use the desired PostgreSQL version
    environment:
      POSTGRES_USER: che
      POSTGRES_PASSWORD: change_this_password
      PGDATA: /data/postgresql
    volumes:
      - che-postgresql-volume:/var/lib/postgresql/data
    networks:
      - che

  eclipse-che-minio:
    image: eclipse/che-minio:1.10.4 # Use the desired version of MinIO
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio-password
      SERVER_ID: 'http://localhost:9000'
    ports:
      - "9000:9000" # MinIO server port
    networks:
      - che

  eclipse-che-sonarqube:
    image: eclipse/che-sonarqube:1.10.4 # Use the desired version of SonarQube
    ports:
      - "9001:9000" # SonarQube port
    networks:
      - che

  eclipse-che-harbor:
    image: eclipse/che-harbor:1.10.4 # Use the desired version of Harbor
    ports:
      - "5000:5000" # Harbor registry port
    networks:
      - che

volumes:
  che-postgresql-volume:
    driver: local

networks:
  che:
    driver: bridge