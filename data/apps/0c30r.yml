version: '3.8'

services:
  reroils-app:
    image: 'quay.io/research_infrastructure/reroils-fullstack:latest' # Use the official RERO ILS Docker image
    container_name: reroils-app
    environment:
      - DB_SERVER=db
      - APP_SECRET=ChangeMe
      - MAILER_FROM=noreply@example.com
      - MAILCAT_HOST=mailcat
    ports:
      - "8082:3000" # Expose the default frontend port (React app)
    depends_on:
      - solr
      - db
      - mailcat
      - fedora
    volumes:
      - ./data/app:/var/www/html
      - ./data/logs:/var/log/reroils
      - ./data/nginx:/etc/nginx
    networks:
      - rero-net

  solr:
    image: 'solr:8.5.0' # Use the Solr version compatible with RERO ILS
    container_name: solr
    environment:
      - 'jetty.http.host=localhost'
    ports:
      - "8983:8983"
    volumes:
      - ./data/solr:/opt/solr/server/solr/data
    networks:
      - rero-net

  db:
    image: 'postgres:12.4' # Use a PostgreSQL version compatible with RERO ILS
    container_name: db
    environment:
      - POSTGRES_DB=reroils
      - POSTGRES_USER=reroils
      - POSTGRES_PASSWORD=ChangeMe
    volumes:
      - ./data/db:/var/lib/postgresql/data
    networks:
      - rero-net

  fedora:
    image: 'fedora-repository-image:latest' # Use the Fedora repository image compatible with RERO ILS
    container_name: fedora
    environment:
      - FEDORA_REPOSITORY_NAME=reroils
      - FEDORA_USERNAME=admin
      - FEDORA_PASSWORD=ChangeMe
    volumes:
      - ./data/fedora:/var/lib/fedora-repository
    networks:
      - rero-net

  mailcat:
    image: 'mailcow/mailcow:alpine'
    container_name: mailcat
    environment:
      - MC_ADMINUSER=admin
      - MC_ADMINPASSWORD=ChangeMe
      - TZ=Europe/Zurich
    ports:
      - "10001:10001" # SMTP server
      - "10002:10002" # IMAP/SMTP server
      - "10003:10003" # Admin RPC interface
    volumes:
      - ./data/mailcat:/var/spool/mailcow
    networks:
      - rero-net

networks:
  rero-net:
    driver: bridge