version: '3.8'

services:
  etherpad:
    image: ether/etherpad-lite:latest # Use the official Etherpad image
    container_name: etherpad
    command: --loglevel production
    environment:
      - EP_DB_ADAPTER=postgres
      - EP_DB_HOST=db
      - EP_DB_NAME=etherpad
      - EP_DB_USER=postgres
      - EP_DB_PASSWORD=postdoc
      - EP_SECRET=change_this_to_a_random_string_for_security
      # Uncomment the next line if you need to set the locale (e.g., 'fr_FR')
      # - EP_LOCALE=en_US.utf8
    ports:
      - "9000:9000" # Etherpad's default port (web interface)
    volumes:
      - etherpad-data:/var/lib/etherpad-lite # Persistent storage for Etherpad data
      - ./config:/etc/etherpad-lite # For config.js if you have custom configurations
    depends_on:
      - db

  db:
    image: postgres:13 # Use an official PostgreSQL image
    container_name: etherpad_db
    command: --lc-collation=C
    volumes:
      - etherpad-data:/var/lib/postgresql # Persistent storage for database data
    environment:
      - POSTGRES_DB=etherpad
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postdoc
    ports:
      - "5432:5432" # PostgreSQL default port

volumes:
  etherpad-data:
    driver: local