version: '3.8'
services:
  flipt-server:
    image: flipt/flipt-server:latest
    ports:
      - "4671:4671" # HTTP server port
      - "4672:4672" # gRPC server port (optional, if you want to enable gRPC)
    environment:
      FLIPT_SERVER_JWT_SECRET: your_jwt_secret # A secret key for JWT authentication
      FLIPT_SERVER_DB_HOSTNAME: db # The service name of the database server (if using an external DB, replace with 'external')
      FLIPT_SERVER_DB_DATABASE: flipt # Database name
      FLIPT_SERVER_DB_USERNAME: flipt_user # Database user
      FLIPT_SERVER_DB_PASSWORD: flipt_password # Database password
      FLIPT_SERVER_DB_ENFORCE_SSL: "false" # Set to 'true' if SSL is enforced for the database connection (optional)
    command: >
      sh -c
      "trap exit TERM; while :; do sleep 1 & wait $${!}; done && executive start"
    volumes:
      - flipt-server-storage:/tmp/flipt
      - flipt-server-data:/var/lib/flipt
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: flipt_user
      POSTGRES_PASSWORD: flipt_password
      POSTGRES_DB: flipt
    volumes:
      - flipt-db-data:/var/lib/postgresql

volumes:
  flipt-server-storage:
  flipt-server-data:
  flipt-db-data: