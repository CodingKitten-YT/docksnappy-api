version: '3.8'

services:
  mailu:
    image: 'mailu/mailu:latest' # Use the official Mailu image
    container_name: mailu
    command: -d --quiet --fresh
    restart: unless-stopped
    ports:
      - "8080:80" # HTTP (Web UI)
      - "110:110" # SMTP for sending emails
      - "143:143" # IMAP for receiving emails
      - "587:587" # Submission for sending emails (optional, usually TLS-wrapped SMTP)
    volumes:
      - 'mailu_data:/data' # Persist Mailu data and configuration
    environment:
      - MAILU_LANG=en
      - MAILU_ADMINS=admin@example.com # Replace with your email or a list of admins
      - MAILU_DATABASE_HOST=db
      - MAILU_LOG_LEVEL=info
    depends_on:
      - db

  postgres:
    image: 'postgres:latest'
    volumes:
      - 'mailu_data:/var/lib/postgresql' # Persist PostgreSQL data
    environment:
      - POSTGRES_DB=mailu
      - POSTGRES_USER=mailu
      - POSTGRES_PASSWORD=changeit
    restart: unless-stopped

  redis:
    image: 'redis:latest'
    volumes:
      - 'mailu_data:/data' # Persist Redis data
    restart: unless-stopped

volumes:
  mailu_data: