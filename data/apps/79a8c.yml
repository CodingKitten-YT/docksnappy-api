version: '3.8'

services:
  lemmy:
    image: lemmy/lemmy:latest
    container_name: lemmy
    command: /app/install --force-color --non-interactive CODEOWNERS=false EULA_AGREED=true --admin-invites=true --no-browser
    ports:
      - "8080:8080" # Port for web UI and API
      - "8920:8920" # Admin interface
      - "7301:7301" # Federation port (for running a federated instance)
    volumes:
      - lemmy-data:/app/code
      - ./config:/app/config
    environment:
      TZ: 'Europe/London' # Set your desired timezone here
      POSTGRES_DB: lemmy
      POSTGRES_USER: lemmy
      POSTGRES_PASSWORD: lemmy
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U lemmy"]
      interval: 10s
      timeout: 5s
      retries: 30

  postgres:
    image: postgres:latest
    volumes:
      - lemmy-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: lemmy
      POSTGRES_USER: lemmy
      POSTGRES_PASSWORD: lemmy

volumes:
  lemmy-data: