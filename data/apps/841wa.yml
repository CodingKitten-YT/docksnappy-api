version: '3.8'

services:
  jupyterlab:
    image: jupyter/base-notebook:latest  # You can also use 'jupyter/jupyterlab:latest' if you prefer
    user: "root"
    ports:
      - "8888:notebook"
    volumes:
      - .:/home/jovokit/work
      - jupyter-data:/home/jovokit/.local
    environment:
      - JUPYTERLAB_LAUNCHERS_NAMES=jupyter-notebook,jupyter-lab
      # Uncomment the next line to use JupyterLab by default (instead of the classic notebook interface)
      # - JUPYTER_EXECUTION_NOTEBOOK=jupyter-lab
    depends_on:
      - jupyterhub

  jupyterhub:
    image: jupyterhub/singleuser-jupyterhub:latest
    user: "root"
    volumes:
      - jupyter-data:/home/jovokit/.local
    environment:
      JUPYTERHUB_USER: myuser
      JUPYTERHUB_TOKEN: a_secure_password
      JUPYTERHUB_CONFIG_CONTENTS: |
        c.JupyterHub.executionTimeout = 1800
        c.JupyterHub.ip_config = {
            'JupyterHub.allow_retrieval_of_token': True,
            'JupyterHub.cookie_secure': False,
            'JupyterHub.create_new_user': True,
            'c.JupyterHub.runtime_configurables': {
                'jhub_notebook_default_url': '',
            },
        }
        c.JupyterLabExtensionManager.optional_nbconvert_extensions = [
            'nbsheets.NotebookSheetsExtension'
        ]
    depends_on:
      - postgres

  postgres:
    image: postgres:latest
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: mydb
      POSTGRE_USER: myuser
      POSTGRES_PASSWORD: a_secure_password

volumes:
  jupyter-data:
  postgres-data: