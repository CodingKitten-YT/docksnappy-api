version: '3.8'

services:
  invidious:
    image: invidiousapp/invidious:latest  # Use the official image from Docker Hub
    container_name: invidious
    ports:
      - "8080:8080"  # Expose Invidious on port 8080 of the host
    environment:
      - TZ="Your/Timezone,Etc.Closest"  # Set your timezone (example: Europe/London)
      - ALLOW_YTDL=true  # Enable YTDL for downloading videos
      - YTDL_CONFIG=/root/.ytdl.config  # Path to yt-dlp configuration file, if you have one
    command: -server.enable_request_forgery_protection false  # Disable RFP
    volumes:
      - ./invidious-data:/data  # Mount your local data directory for persistence
      - ./invidious.env:/config/config.env:ro  # Mount an optional environment overrides file
    restart: unless-stopped  # Restart the container unless it's been explicitly stopped

  postgres:
    image: postgres:latest  # Use the official PostgreSQL image from Docker Hub
    container_name: invidious_postgres
    volumes:
      - ./invidious-data/db:/var/lib/postgresql/data  # Mount your local database data directory for persistence
    environment:
      - POSTGRES_DB=invidious  # Database name
      - POSTGRES_USER=invidious  # Database user
      - POSTGRES_PASSWORD=your_password  # Database password (change this!)
    restart: unless-stopped  # Restart the container unless it's been explicitly stopped

  redis:
    image: redis:latest  # Use the official Redis image from Docker Hub
    container_name: invidious_redis
    volumes:
      - ./invidious-data/redis:/data  # Mount your local Redis data directory for persistence
    restart: unless-stopped  # Restart the container unless it's been explicitly stopped

networks:
  default:
    driver: bridge  # Use the bridge network driver