version: '3.8'

services:
  ente:
    image: entegram/ente:latest  # Use the official or tagged image as per your preference
    ports:
      - "8000:8000"  # Expose Ente's default port, you might need to change this if you use a different port
    depends_on:
      - db
      - redis
    environment:
      ENTE_HOST: 'db'  # Assuming 'db' is the service name for your PostgreSQL instance
      ENTE_REDIS_HOST: 'redis'  # Assuming 'redis' is the service name for your Redis instance
      ENTE_SECRET_KEY: 'your-secret-key'  # Set a secret key for Ente to generate secure tokens, etc.
      ENTE_ALLOWED_HOSTS: '*'  # Set allowed hosts, can be 'localhost', '127.0.0.1', or '*' for local development
      ENTE_DB_USER: 'ente_user'  # PostgreSQL user for Ente
      ENTE_DB_PASSWORD: 'ente_password'  # PostgreSQL password for Ente
      ENTE_DB_NAME: 'ente'  # Name of the database that Ente will use
    volumes:
      - ente-data:/code/data  # Persistent storage for Ente files, you can adjust the path as needed
    restart: unless-stopped  # Ensure Ente restarts automatically on failure

  db:
    image: postgres:latest
    environment:
      POSTGRES_USER: 'ente_user'
      POSTGRES_PASSWORD: 'ente_password'
      POSTGRES_DB: 'ente'
    volumes:
      - ente-dbdata:/var/lib/postgresql/data  # Persistent storage for PostgreSQL data
    restart: unless-stopped

  redis:
    image: redis:latest
    volumes:
      - ente-redisdata:/data  # Persistent storage for Redis data, you can adjust the path as needed
    restart: unless-stopped

volumes:
  ente-data:
  ente-dbdata:
  ente-redisdata: