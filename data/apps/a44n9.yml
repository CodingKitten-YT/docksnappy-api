version: '3.8'

services:
  cerbos:
    image: cerbos/cerbos:latest
    container_name: cerbos
    ports:
      - "9090:9090" # Cerbos HTTP API
    command:
      - "--auth-service=/tmp/oauthtoken" # Use an in-memory auth service for simplicity
      - --allow-unauthenticated # Allows unauthenticated requests (not recommended for production)
    volumes:
      - ./cerbos-auth:/tmp/oauthtoken # Mount a directory for the OAuth token storage (optional, for persistence)
    networks:
      - cerbos_network

  cerbos-db:
    image: postgres:latest
    container_name: cerbos-db
    volumes:
      - ./cerbos-db-data:/var/lib/postgresql # Persist database data
    environment:
      POSTGRES_USER: cerbos
      POSTGRES_PASSWORD: cerbos_password # Change this password for production use
    networks:
      - cerbos_network

networks:
  cerbos_network:
    driver: bridge