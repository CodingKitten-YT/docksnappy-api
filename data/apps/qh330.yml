version: '3.8'

services:
  admido-api:
    image: admido/admido:latest
    container_name: admido-api
    environment:
      ADMIDO_SECRET_KEY: ${RANDOM:-"secret_key"} # Change this with a real secret key in production
      ADMIDO_DATABASE_URL: postgres://admido-db:5432/admido  # PostgreSQL connection string
      ADMIDO_REDIS_URL: redis://admido-redis:6379/0            # Redis connection string
    ports:
      - "8000:8000"                                     # Adjust if you want to expose a different port
    depends_on:
      - admido-db
      - admido-redis
    healthcheck:
      test: ["CMD", "curl", "--fail", "localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 30

  admido-db:
    image: postgres:latest
    container_name: admido-db
    environment:
      POSTGRES_DB: admido        # Database name
      POSTGRES_USER: admido       # Database user
      POSTGRES_PASSWORD: admido   # Database password
    volumes:
      - admido-db-data:/var/lib/postgresql/data  # Persistent volume for database data

  admido-redis:
    image: redis:latest
    container_name: admido-redis

volumes:
  admido-db-data:
    driver: local