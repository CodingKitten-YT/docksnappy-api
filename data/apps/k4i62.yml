version: '3.8'

services:
  monica:
    image: monica/monica:latest
    ports:
      - "5000:5000" # Expose the default port Monica uses for the web interface
    environment:
      MONICA_SECRET_KEY: "${MONICA_SECRET_KEY}" # Set your secret key, use `monica generate-key` to create one
      MONICA_DB_HOST: db  # Use service name 'db' for the database host
      MONICA_DB_USER: "${MONICA_DB_USER}"  # Your database user
      MONICA_DB_PASSWORD: "${MONICA_DB_PASSWORD}"  # Your database password
      MONICA_DB_NAME: "${MONICA_DB_NAME}"  # Your database name
      MONICA_DB_DBMS: "postgres"  # The database engine (e.g., postgres, mysql)
      MONICA_LOAD_ENVIRONMENT_VARIABLES: "true"  # Load environment variables from a .env file if you have one
    volumes:
      - ./data/monica:/data/monica  # Path to your Monica data directory (persistent storage)
    depends_on:
      - db  # Ensure 'db' service is up before 'monica'
    networks:
      - monicanetwork

  db:
    image: postgres:latest
    volumes:
      - ./data/db:/var/lib/postgresql/data  # Path to your PostgreSQL data directory (persistent storage)
    environment:
      POSTGRES_DB: "${POSTGRES_DB}"  # Your database name
      POSTGRES_USER: "${POSTGRES_USER}"  # Your database user
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"  # Your database password
    networks:
      - monicanetwork

networks:
  monicanetwork:
    driver: bridge