version: '3.8'

services:
  ergo_node:
    image: 'ergo/ergo-node'
    container_name: ergo_node
    ports:
      - "12701:12701" # Ergo Node default port for RPC (optional, if you want to access from the host)
    volumes:
      - "./data:/root/.ergo" # Mount your local data directory to store node data and blocks
      - "./nodes.json:/etc/ergo/nodes.json" # Optional, mount nodes configuration file (if you have one)
    environment:
      - "ERGO_NETWORK=${ERGO_NETWORK:-mainnet}" # Set network (testnet/mainnet), default to mainnet if not specified
      - "ERGO_NODE_HTTP_EXPOSED=true" # Expose HTTP RPC (optional)
      - "ERGO_RPC_LISTEN_ADDRESS=0.0.0.0" # Listen on all network interfaces for RPC (optional)
      - "ERGO_TEZOS_MNMON_ACTIVE=false" # Disable Tezos Mnemonic (optional, if you don't use it)
    restart: unless-stopped

  ergo_explorer:
    image: 'ergo/ergo-explorer'
    container_name: ergo_explorer
    ports:
      - "12702:12702" # Ergo Explorer default port (optional, if you want to access from the host)
    environment:
      - "ERGO_NODE_HOST=ergo_node" # Reference to the ergo_node service
      - "ERGO_NODE_PORT=12701" # Port where ergo_node is listening (if different from the exposed port)
      - "ERGO_RPC_USERNAME=user" # Username for RPC authentication (optional, configure as needed)
      - "ERGO_RPC_PASSWORD=password" # Password for RPC authentication (optional, configure as needed)
    depends_on:
      - ergo_node
    restart: unless-stopped

  prometheus:
    image: 'prom/prometheus'
    container_name: prometheus
    volumes:
      - "./prometheus:/etc/prometheus"
    ports:
      - "9090:9090" # Prometheus default port (optional, if you want to access from the host)
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    restart: unless-stopped

  grafana:
    image: 'grafana/grafana'
    container_name: grafana
    ports:
      - "3000:3000" # Grafana default port (optional, if you want to access from the host)
    volumes:
      - "./grafana:/etc/grafana"
    environment:
      - "GF_SECURITY_ADMIN_PASSWORD=admin-password" # Set your admin password for Grafana
    depends_on:
      - prometheus
    restart: unless-stopped

  ergo_fullnode_monitoring:
    image: 'ergo/ergo-telemetry'
    container_name: ergo_fullnode_monitoring
    volumes:
      - "./prometheus/data:/prometheus" # Mount the Prometheus data directory to store metrics
    depends_on:
      - ergo_node
      - prometheus
    restart: unless-stopped

# Uncomment the following services if you want to enable them
# ergo_web_wallet:
#   image: 'ergo/ergo-web-wallet'
#   container_name: ergo_web_wallet
#   ports:
#     - "12345:80"
#   environment:
#     - "ERGO_NODE_HOST=ergo_node"
#     - "ERGO_NODE_PORT=12701"
#   depends_on:
#     - ergo_node
#   restart: unless-stopped

# Note: Adjust the image tags to the latest versions or specific tags you need.