version: '3.8'

services:
  mongooseim:
    image: 'mongooseim/mongooseim:latest' # Use the official MongooseIM image
    container_name: mongooseim
    ports:
      - "5280:5280" # XMPP client port (canonical)
      - "5445:5445" # XMPP client port (non-canonical, optional)
    environment:
      MONGOOSEIM_ADMIN_PASSWORD: change_me # Set an admin password for the admin user
      MONGOOSEIM_ADMIN_USERNAME: admin # Admin user credentials
      MONGOOSEIM_DOMAIN: example.com # Set your domain/bare JID
      MONGOOSEIM_STORAGE_DBTYPE: postgres # Storage backend (postgres, mysql, or sqlite3)
      MONGOOSEIM_STORAGE_PG_HOST: db # Host for the PostgreSQL server if using PostgreSQL
      MONGOOSEIM_STORAGE_MY_HOST: db-mysql # Host for the MySQL server if using MySQL
      MONGOOSEIM_POSTGRESQL__USER: mongooseim # User for the PostgreSQL database
      MONGOOSEIM_POSTGRESQL__DB: mongooseim # Database for MongooseIM to use
    volumes:
      - mongooseim-data:/var/lib/mongooseim # Persistent storage for MongooseIM data
    depends_on:
      - db  # Depend on the database service defined below

  db:
    image: postgres:latest
    container_name: mongooseim-db
    environment:
      POSTGRES_USER: mongooseim
      POSTGRES_DB: mongooseim
      POSTGRES_PASSWORD: change_me # Set a password for the PostgreSQL user
    volumes:
      - mongooseim-db-data:/var/lib/postgresql # Persistent storage for the database data

volumes:
  mongooseim-data:
  mongooseim-db-data: