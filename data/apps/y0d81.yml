version: '3.8'

services:
  geoserver:
    image: geoapplied/geoserver
    ports:
      - "8080:8080" # GeoServer web admin interface
      - "8090:8090" # REST and WMS services (Note: If you need SSL, this should be 4090)
    environment:
      - GEOSERVER_DATA_STORE_STORE=appdata # Optional data store container to be created below
      - GEOSERVER_DB_URL=jdbc:mysql://dbserver:5432/geodb
      - GEOSERVER_DB_USERNAME=geouser
      - GEOSERVER_DB_PASSWORD=yourpassword
    volumes:
      - geoserver-data:/opt/geoserver/data_dir
      - geoserver-logs:/opt/geoserver/logs/
      - ./webapps/geoshop:/opt/geoserver/webapps/geoshop/
    depends_on:
      - dbserver

  postgis_dbserver: # Alternative to MySQL if PostgreSQL is preferred
    image: postgis:13-2.5
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=geodb
      - POSTGRES_USER=geouser
      - POSTGRES_PASSWORD=yourpassword

  geoserver_appdata: # Optional data store service for GeoServer
    image: geoapplied/gda_store_geoserver
    environment:
      - GDASTORE_GS_HOME=/opt/geoserver
      - GDASTORE_TYPE=postgis # or 'mysql' if using MySQL
      - GDASTORE_DB_USERNAME=geouser
      - GDASTORE_DB_PASSWORD=yourpassword
    depends_on:
      - dbserver # or geoserver if using MySQL
    volumes:
      - appdata-volume:/opt/gda_store/data

volumes:
  geoserver-data:
  geoserver-logs:
  postgres-data:
  appdata-volume:

networks:
  geo2tz_default:
    driver: bridge