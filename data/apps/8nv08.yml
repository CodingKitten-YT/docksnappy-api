version: '3'
services:
  photofield-orbitdb:
    image: orbitdb/photofield
    environment:
      - ORBITDB_DEFAULT_KEY=process.env.ORBITDB_DEFAULT_KEY
      - ORBITDB_NODE_CONFIG={"chain":"ipfs","protocols":["/ipld/dag-pb"]}
    ports:
      - "8000:8000" # PeerStore HTTP API (optional)
    networks:
      - photofield-network

  photofield-websocket:
    image: orbitdb/photofield-websocket
    depends_on:
      - ipfs
      - orbitdb
    environment:
      - ORBITDB_WEBSOCKET_HOST=ipfs
      - ORBITDB_DEFAULT_KEY=process.env.ORBITDB_DEFAULT_KEY
    ports:
      - "3000:3000" # Websocket RPC server (optional)
    networks:
      - photofield-network

  ipfs:
    image: ipfs/go-ipfs:latest
    ports:
      - "5001:5001" # API (optional)
      - "8080:8080" # Gateway (optional)
    volumes:
      - "${HOME}/.ipfs:/root/.ipfs"
    command: -config /root/.ipfs/global/config.json
    networks:
      - photofield-network

networks:
  photofield-network:
    driver: bridge