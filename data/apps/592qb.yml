version: '3.8'

services:
  appserver:
    image: middlewared/middleware:latest # Replace with the specific tag or custom image if needed
    container_name: middleware_appserver
    environment:
      SERVICES_APPSERVER_ENABLE: "1"
    ports:
      - "8080:8080" # Default HTTP API port
      - "8181:8181" # Default Web UI port
    networks:
      - middleware-network

  database:
    image: postgres:latest # Replace with the specific PostgreSQL version if needed
    container_name: middleware_database
    volumes:
      - ./data/db:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: middleware
      POSTGRES_USER: middleware
      POSTGRES_PASSWORD: secret
    networks:
      - middleware-network

  redis:
    image: redis:latest # Replace with the specific Redis version if needed
    container_name: middleware_redis
    ports:
      - "6379:6379"
    networks:
      - middleware-network

  etcd:
    image: etcd:latest # Replace with the specific etcd version if needed
    container_name: middleware_etcd
    volumes:
      - ./data/etcd:/etc/etcd
    networks:
      - middleware-network

networks:
  middleware-network:
    driver: bridge