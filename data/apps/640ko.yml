version: '3.8'

services:
  scoold_db:
    image: postgres:12
    command: >
      postgres -c 'listen_addresses = 0.0.0.0, ::0' # default is to listen on localhost only
    volumes:
      - scoold_db-data:/var/lib/postgresql2
    environment:
      POSTGRES_DB: scoold
      POSTGRES_USER: scoold
      POSTGRES_PASSWORD: change_this_password
    ports:
      - "5432:5432"

  scoold_redis:
    image: redis:6.0-alpine
    command: redis-server --appendonly yes

  scoold_frontend:
    image: scoold/scoold-frontend:v1.8.0
    ports:
      - "3000:3000"
    depends_on:
      - scoold_db
      - scoold_redis
      - scoold_backend

  scoold_backend:
    image: scoold/scoold-backend:v1.8.0
    ports:
      - "4000:4000"
    depends_on:
      - scoold_db
      - scoold_redis
      - scoold_frontend

  scoold_worker:
    image: scoold/scoold-worker:v1.8.0
    command: gunicorn -w 4 -b :8000 scoold.wsgi:application
    depends_on:
      - scoold_db
      - scold_redis
    volumes:
      - .:/app
    ports:
      - "8000:8000"

volumes:
  scoold_db-data: