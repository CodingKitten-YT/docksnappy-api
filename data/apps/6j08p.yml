version: '3.8'

services:
  frigate:
    image: frigate/frigate:latest  # You can also specify a tag if you prefer a specific version
    container_name: frigate
    ports:
      - "8081:80"  # Expose Frigate UI on port 8081 (host) to port 80 (container)
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London  # Set the timezone, adjust to your needs
      - INFLUXDB_HOST=influxdb  # If you are using an InfluxDB service
      - TELEGRAM_ENABLE=true  # Enable Telegram integration if desired
      - TELEGRAM_TOKEN=your_bot_token  # Your Telegram bot token
      - TELEGRAM_CHAT_ID=your_chat_id  # Your Telegram chat ID
    volumes:
      - "./config:/config"  # Mount your local config directory to the container
      - "./data:/data"  # Mount your local data directory to the container (optional, for data persistence)
    networks:
      - homeassistant_network  # If you are integrating with Home Assistant, use the same network

  influxdb:
    image: frigate/influxdb:latest
    container_name: influxdb
    volumes:
      - "./data/influxdb:/var/lib/influxdb"  # Mount your local data directory for InfluxDB to persist data
    environment:
      - PUID=1000
      - PGID=1000
    networks:
      - homeassistant_network  # If you are integrating with Home Assistant, use the same network

  nginx-proxy:
    image: nginx-proxy/nginx-proxy:stable
    container_name: nginx-proxy
    ports:
      - "80:80"  # Map port 80 to the Nginx proxy for routing
      - "443:443"  # Map port 443 to the Nginx proxy for HTTPS (if you have a Let's Encrypt setup)
    volumes:
      - "/var/lib/docker/containers/:/var/lib/docker/containers/:ro"  # Required by nginx-proxy
      - "./letsencrypt:/etc/letsencrypt"  # If you are using Let's Encrypt for certificates
    depends_on:
      - frigate

  homeassistant:
    image: homeassistant/home-assistant:stable
    container_name: homeassistant
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - "./data/homeassistant:/config"
      - "./data/homeassistant/addons:/addons"
    ports:
      - "32768-32868:32768-32868"  # Home Assistant default port range (optional, if you want to access from outside the host)
    networks:
      - homeassistant_network

networks:
  homeassistant_network:
    name: homeassistant_network