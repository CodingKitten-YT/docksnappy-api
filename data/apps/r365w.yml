version: '3.8'
services:
  manyfold:
    image: 'manyflow/manyfold:latest' # Use the official Manyfold image from Docker Hub
    ports:
      - "4000:4000" # Expose the default Manyfold port for web access
    environment:
      MANYFOLD_DB_HOST: db # Reference the database service by name
      MANYFOLD_DB_USERNAME: manyfold # Database user for Manyfold
      MANYFOLD_DB_PASSWORD: verysecretpassword # Database password for Manyfold
      MANYFOLD_DB_DATABASE: manyfold # Database name for Manyfold
    depends_on:
      - db
    volumes:
      - './data:/data' # Mount a volume to persist Manyfold data
    networks:
      - manyfold-network

  postgres:
    image: 'postgres:13' # Use PostgreSQL 13 as the database server
    environment:
      POSTGRES_USER: manyfold
      POSTGRES_PASSWORD: verysecretpassword
      POSTGRES_DB: manyfold
    volumes:
      - './dbdata:/var/lib/postgresql/data' # Mount a volume to persist database data
    networks:
      - manyfold-network

networks:
  manyfold-network:
    driver: bridge