version: '3.7'

services:
  atomic-server:
    image: 'bitnami/atomic-server:latest'
    ports:
      - "8080:8080" # HTTP API port
      - "5672:5672"   # RabbitMQ port (if enabled)
      - "4318:4318"  # Redis port (if enabled)
    environment:
      ATOMIC_SERVER_PASSWORD: "your_secure_password"
      ATOMIC_DATABASE_HOST: db
      ATOMIC_REDIS_HOST: redis
      ATOMIC_RABBITMQ_HOST: rabbitmq
      SERVICE_REGISTRY_ENABLED: 'true' # Set to 'false' if you don't want it enabled
    command: /usr/src/app/run.sh -c /etc/atomic-server.conf
    depends_on:
      - db
      - redis
      - rabbitmq
    volumes:
      - type: bind
        source: ./atomic-server.conf
        target: /etc/atomic-server.conf
      - type: tar
        source: ./data
        target: /tmp/atomic-server-data.tar
      - type: tar
        source: ./logs
        target: /tmp/atomic-server-logs.tar
    networks:
      - atomic_network

  db:
    image: 'postgres:latest'
    volumes:
      - type: bind
        source: ./db-data
        target: /var/lib/postgresql/data
    environment:
      POSTGRES_USER: "atomic"
      POSTGRES_PASSWORD: "your_database_password"
      POSTGRES_DB: "atomic"
    networks:
      - atomic_network

  redis:
    image: 'redis:latest'
    volumes:
      - type: bind
        source: ./redis-data
        target: /data
    networks:
      - atomic_network

  rabbitmq:
    image: 'rabbitmq:latest'
    networks:
      - atomic_network

networks:
  atomic_network:
    driver: bridge