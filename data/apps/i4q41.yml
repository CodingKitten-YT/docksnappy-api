version: '3.8'

services:
  formiojs:
    image: formio/formiojs:latest
    container_name: formiojs
    environment:
      FORMIO_LICENSE_KEY: "YOUR_LICENSE_KEY" # Uncomment and set your Form.io license key if you have one
      NODE_ENV: production
    ports:
      - "8081:3000"
    networks:
      - formio-network

  postgres:
    image: postgres:latest
    container_name: postgres
    environment:
      POSTGRES_DB: formio
      POSTGRES_USER: formio
      POSTGRES_PASSWORD: changeit
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - formio-network

  rabbitmq:
    image: rabbitmq:3.8-management
    container_name: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    networks:
      - formio-network

  minio:
    image: minio:latest
    container_name: minio
    ports:
      - "9000:9000"
    environment:
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadminpass
      MINIO_ROOT_USER: minioadmin
      MINIO_ROBUST: true
    volumes:
      - minio-data:/data
    networks:
      - formio-network

  casbin-authz:
    image: casbin/docker:v4.15.2-caddy
    container_name: casbin-authz
    ports:
      - "8080:8080"
    networks:
      - formio-network
    depends_on:
      - formiojs

  formio-formio-redis:
    image: redis:latest
    container_name: formio-redis
    networks:
      - formio-network

  formio-be:
    image: formio/formio-be:latest
    depends_on:
      - formiojs
      - postgres
      - casbin-authz
      - formio-formio-redis
    networks:
      - formio-network

  formio-fe:
    image: formio/formio-fe:latest
    depends_on:
      - formiojs
    networks:
      - formio-network

  kibana: # Optional Elasticsearch monitoring (if you have Elasticsearch set up)
    image: elastic/kibana:7.10.2
    container_name: kibana
    environment:
      ELASTIC_SECURITY_USER: "kibana"
      ELASTIC_SECURITY_PASSWORD: "kibana"
    ports:
      - "5601:5601"
    networks:
      - formio-network

volumes:
  postgres-data:
    driver: local
  minio-data:
    driver: local

networks:
  formio-network:
    driver: bridge