version: '3.7'

services:
  flexisip:
    image: "flexisip/core:latest" # Use the official FlexiSIP Core image or a specific tag
    container_name: flexisip
    ports:
      - "8080:8080" # Web interface
      - "5060:5060" # SIP server
      - "5061:5061" # SIP client
    volumes:
      - ./config:/etc/flexisip # Mount your configuration directory to the container
      - ./logs:/var/log/flexisip # Mount a logs directory to store log files from the container
      - ./sip_certificates:/etc/flexisip/certificates # Mount a directory with SSL certificates if needed
    environment:
      - TZ=Europe/Paris # Set the timezone, change to your desired timezone
      - LOGLEVEL=info # Set the log level (debug, info, warning, error)
      - REGISTER_STRATEGY=least_routes # Configure register strategy (least_routes, round_robin, least_load, random, least_cost)
    restart: unless-stopped

  redis:
    image: "redis:latest"
    container_name: flexisip_redis
    command: "RedisStart=yes"
    volumes:
      - "./data/redis:/data" # Persist Redis data
    restart: unless-stopped

  mysql:
    image: "mysql:5.7"
    container_name: flexisip_mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: flexisip
      MYSQL_USER: flexisipuser
      MYSQL_PASSWORD: flexisippass
    volumes:
      - "./data/mysql:/var/lib/mysql" # Persist MySQL data
    restart: unless-stopped

  postgres:
    image: "postgres:latest"
    container_name: flexisip_postgres
    environment:
      POSTGRES_DB: flexisip
      POSTGRES_USER: flexisipuser
      POSTGRES_PASSWORD: flexisippass
    volumes:
      - "./data/postgres:/var/lib/postgresql" # Persist PostgreSQL data
    restart: unless-stopped

networks:
  default:
    driver: bridge