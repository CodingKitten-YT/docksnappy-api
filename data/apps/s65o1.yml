version: '3.8'

services:
  tailchat-postgres:
    image: postgres:13
    command: postgres -c 'listen_addresses = 0.0.0.0' # for access from the host/other containers
    environment:
      POSTGRES_USER: tailchat
      POSTGRES_PASSWORD: tailchat-secret
      POSTGRES_DB: tailchat
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432" # host port : container port

  tailchat-backend:
    image: tailchat/tailchat-backend:latest
    depends_on:
      - tailchat-postgres
    environment:
      DATABASE_URL: postgres://tailchat:tailchat-secret@postgres-data:5432/tailchat
      TAILCHAT_JWT_SECRET: tailchat-jwt-secret # use a random secret or manage it securely
    ports:
      - "8000:8000" # host port : container port for backend API

  tailchat-frontend:
    image: tailchat/tailchat-web:latest
    depends_on:
      - tailchat-backend
    environment:
      REACT_APP_BACKEND_URL: http://backend:8000
    ports:
      - "3000:3000" # host port : container port for frontend web app

volumes:
  postgres-data: