version: '3'

services:
  flagsmith-db:
    image: postgres:12
    command: postgres -c 'fsync=OFF' -c 'full_page_writes=OFF'
    volumes:
      - flagsmith-db-data:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: ${FLAGSMITH_DB_USER}
      POSTGRES_PASSWORD: ${FLAGSMITH_DB_PASSWORD}
      POSTGRES_DB: ${FLAGSMITH_DB_NAME}
    networks:
      - flagsmith-net

  flagsmith:
    image: flagsmith/flagsmith:latest
    depends_on:
      - flagsmith-db
    environment:
      FLAGSMITH_DATABASE_HOST: flagsmith-db
      FLAGSMITH_DATABASE_USER: ${FLAGSMITH_DB_USER}
      FLAGSMITH_DATABASE_PASSWORD: ${FLAGSMITH_DB_PASSWORD}
      FLAGSMITH_DATABASE_NAME: ${FLAGSMITH_DB_NAME}
      FLAGSMITH_DATABASE_PORT: 5432
    ports:
      - "9090:9090" # Default port for Flagsmith API
    volumes:
      - ./flagsmith.env:/etc/Flagsmith/flagsmith.env
    networks:
      - flagsmith-net

volumes:
  flagsmith-db-data:

networks:
  flagsmith-net:
    driver: bridge

variables:
  FLAGSMITH_DB_USER: flagsmith
  FLAGSMITH_DB_PASSWORD: some_password
  FLAGSMITH_DB_NAME: flagsmith