version: '3.8'
services:
  xwiki:
    image: 'tryton/xwiki-full:10.10.5' # Use the official XWiki image or a specific version
    ports:
      - "8080:8080" # Expose the default Tomcat port (optional, if you want to access XWiki via browser)
    environment:
      JVM_OPTS: "-Xms256m -Xmx1024m -XX:+UseG1GC" # Java heap size, memory configuration for the JVM
      XWIKI_USER: xwiki
      XWIKI_PASSWORD: xwiki
    volumes:
      - xwiki-data:/data # Persistent storage for XWiki data
    depends_on:
      - mysql

  mysql:
    image: 'mysql:5.7' # Use the official MySQL image or a specific version
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: xwiki
      MYSQL_USER: xwiki
      MYSQL_PASSWORD: xwikipassword
    volumes:
      - db-data:/var/lib/mysql # Persistent storage for MySQL data

  nginx-proxy:
    image: 'jwilder/nginx-proxy' # Reverse proxy and load balancer
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./letsencrypt:/etc/letsencrypt # Let's Encrypt certificates (if you want SSL/TLS)
      - nginx-conf:/etc/nginx/conf.d # Nginx configuration files
    depends_on:
      - xwiki

volumes:
  xwiki-data:
  db-data:
  nginx-conf: