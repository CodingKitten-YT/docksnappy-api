version: '3.8'

services:
  tooljet_idb:
    image: tooljetenterprise/tooljet:latest-community
    container_name: tooljet_idb
    environment:
      TJ_LICENSE_KEY: YOUR_LICENSE_KEY # Set your ToolJet license key if you have an enterprise subscription
      POSTGRES_DB: tooljet
      POSTGRES_USER: tooljet
      POSTGRES_PASSWORD: tooljet
    volumes:
      - ./tooljet-data:/data/appdb
      - ./tooljet-logs:/var/log/tooljet
      - ./tooljet-conf:/etc/tooljet
    ports:
      - "8001:8001" # Web UI Port
      - "5601:5601" # Adminer (Database Manager) Port (Optional)
    networks:
      - tooljet_network
    commandReview: "--idb --db_type postgresql"

  tooljet_redis:
    image: redis:latest
    container_name: tooljet_redis
    volumes:
      - ./tooljet-redis:/data
    networks:
      - tooljet_network

  tooljet_rabbitmq:
    image: rabbitmq:3.8-management
    container_name: tooljet_rabbitmq
    ports:
      - "5672:5672" # RabbitMQ Port (Default port)
    networks:
      - tooljet_network
    environment:
      RABBITMQ_DEFAULT_USER: user
      RABBITMQ_DEFAULT_PASS: password # Change the default password for security purposes

  tooljet_celery_worker:
    image: celery:1.0-supervisor
    container_name: tooljet_celery_worker
    command: celery -A tooljet worker --loglevel=info
    depends_on:
      - tooljet_idb
    networks:
      - tooljet_network

  tooljet_api:
    image: tooljetenterprise/tooljet-api:latest-community
    container_name: tooljet_api
    environment:
      REGISTRY_URL: http://tooljet_idb:8001
      REDIS_HOST: tooljet_redis
      RABBITMQ_HOST: tooljet_rabbitmq
      RABBITMQ_USER: user
      RABBITMQ_PASS: password
    depends_on:
      - tooljet_idb
    networks:
      - tooljet_network

networks:
  tooljet_network:
    driver: bridge