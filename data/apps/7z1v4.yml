version: '3.8'

services:
  glance-api:
    image: openstack/glance-api:latest
    container_name: glance-api
    environment:
      GLANCE_STORE: mongodb
      GLANCE_NOTIFY_QUEUESV2_ENABLED: true
      RABBITMQ_HOST: rabbitmq
      SERVICE_HOST: 0.0.0.0
      SERVICE_PORT: 9292
    ports:
      - "9292:9292"
    depends_on:
      - mongodb
      - rabbitmq
      - registry-backend

  glance-registry:
    image: openstack/glance-registry:latest
    container_name: glance-registry
    environment:
      GLANCE_STORE: file
      REGISTRY_BACKEND: file
    volumes:
      - ./data:/var/lib/glance/images
    depends_on:
      - novnc-proxy

  mongodb:
    image: mongo:latest
    container_name: mongodb
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: your_root_password
    volumes:
      - mongodata:/data/db
    ports:
      - "27017:27017"

  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitdata:/var/lib/rabbitmq

  registry-backend:
    image: openstack/glance-store-file:latest
    container_name: registry-backend
    depends_on:
      - mongodb

volumes:
  mongodata:
  rabbitdata: