version: '3.8'

services:
  pairdrop:
    image: pairdrop/pairdrop:latest
    ports:
      - "8080:80" # HTTP port
    environment:
      Pairdrop_SECRET_KEY: ${RANDOM} # For development, in production use an environment variable or a secret manager
      Pairdrop_DATABASE_URL: postgres://pairdrop:${DB_PASSWORD}@db:5432/pairdrop  # Use DATABASE_URL env var for dynamic config
    volumes:
      - ./data:/code/data  # Persist data (migrations, uploaded files, etc.)
      - ./pairdrop.conf:/code/pairdrop.conf  # Custom configuration file if needed
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_DB: pairdrop
      POSTGRES_USER: pairdrop
      POSTGRES_PASSWORD: ${DB_PASSWORD} # Set the DB_PASSWORD in your .env file or pass it as a docker-compose run argument
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data: