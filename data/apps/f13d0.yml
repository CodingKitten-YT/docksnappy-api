version: '3.7'

services:
  gophish_application:
    image: gophish/gophish:latest
    container_name: gophish
    ports:
      - "90:80" # HTTP
      - "9443:443" # HTTPS (if you have a reverse proxy like Traefik or Nginx)
    volumes:
      - ./gophish_data:/data
      - ./gophish_letsencrypt:/etc/letsencrypt
      - ./gophish_ssl:/etc/ssl
    environment:
      - DB_TYPE=mysql
      - DB_HOST=db_gophish
      - DB_NAME=gophish
      - DB_USER=gophish
      - DB_PASSWORD=changeit
      - SECURE_COOKIE=false # Set to true in production for HTTPS
      - DEFAULT_EMAIL_DOMAIN=example.com # Replace with your domain
      - ADMINS=admin@example.com # Comma-separated list of admin emails
      - SUPERSECRET=supersecretkey # Change to a random secret for security
    depends_on:
      - db_gophish
    networks:
      - gophish_network

  gophish_database:
    image: mysql:5.7
    container_name: db_gophish
    environment:
      MYSQL_DATABASE=gophish
      MYSQL_USER=gophish
      MYSQL_PASSWORD=changeit
      MYSQL_ROOT_PASSWORD=rootpassword
    volumes:
      - ./gophish_db_data:/var/lib/mysql
    networks:
      - gophish_network

networks:
  gophish_network:
    driver: bridge