version: '3.8'

services:
  metabase:
    image: metabase/metabase:latest # or use a specific version like metabase/metabase:0.41.0
    container_name: metabase
    ports:
      - "3000:3000" # HTTP port, accessible from the host
      - "3001:3001" # Admin interface on a different port for security reasons
    volumes:
      - "./metabase:/var/lib/metabase" # Mount your Metabase data here
      - "./metabase-config.yml:/etc/metabase/conf/metabase.yml" # Optional, mount your custom Metabase configuration file if you have one
    environment:
      MB_DATABASE_URL: "postgres://postgres:password@db:5432/database" # Replace with your database connection string
      JVM_OPTS: "-Xmx756m -Xms512m" # Adjust JVM memory settings as needed
    depends_on:
      - db
    networks:
      - metabase_network

  postgres:
    image: postgres:latest # or use a specific version like postgres:13.0
    container_name: postgres
    volumes:
      - "./postgres-data:/var/lib/postgresql" # Persist your database data here
    environment:
      POSTGRES_DB: database # Replace with your desired database name
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password # Make sure to change this in a secure manner, e.g., using Docker secrets or an env file that is not checked into version control
    networks:
      - metabase_network

networks:
  metabase_network:
    driver: bridge