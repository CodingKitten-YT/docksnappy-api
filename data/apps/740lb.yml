version: '3.8'
services:
  donetick_api:
    image: donetick/donetick-api:latest
    ports:
      - "5001:5000" # Expose the API on host port 5001 (HTTP)
    environment:
      DONETICK__API__HOST: '0.0.0.0'
      JWT_SECRET: 'your_jwt_secret' # Replace with a strong, secret key for JWT tokens
    depends_on:
      - postgres

  donetick_redis:
    image: redis:6-alpine
    command: redis-server --appendonly yes
    volumes:
      - 'redis-data:/data' # Persist Redis data with a named volume

  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: donetick
      POSTGRES_USER: donetick
      POSTGRES_PASSWORD: donetick_password # Replace with a strong password for the database
    volumes:
      - 'postgres-data:/var/lib/postgresql' # Persist PostgreSQL data with a named volume

  donetick_worker:
    image: donetick/donetick-worker:latest
    depends_on:
      - donetick_api
      - postgres
      # In production, consider running the worker on the same host as the API for simplicity and performance.

volumes:
  redis-data:
  postgres-data: