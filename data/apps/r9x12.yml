version: '3.8'

services:
  eda_notebook_service:
    image: puckel/dask-gateway
    environment:
      - HAS_GAN=true
      # Set the number of worker processes here (default is 4)
      - NUM_WORKERS=4
      # Optionally set a specific dask scheduler address if it's different from localhost
      - LOCALROOT_HOSTNAME=localhost
    ports:
      - "8888:8888"
    command: --allow-root
    volumes:
      - ./notebooks:/home/jovyan/.local/share/jupyter/notebooks
      - ./data:/data
    depends_on:
      - eda_db_service

  eda_db_service:
    image: postgres:13
    environment:
      POSTGRES_DB: eda
      POSTGRES_USER: edauser
      POSTGRES_PASSWORD: edapassword
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U eda"]
      timeout: 10s
      retries: 5

  timescale_service:
    image: timescale/timescaledb:latest
    depends_on:
      - eda_db_service
    environment:
      POSTGRES_DB: eda
      POSTGRES_USER: edauser
      POSTGRES_PASSWORD: edapassword
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U eda"]
      timeout: 10s
      retries: 5

  eda_app_service:
    image: your-eda-application-image:latest
    environment:
      - EDA_DB_HOST=eda_db_service
      - EDA_DB_USERNAME=edauser
      - EDA_DB_PASSWORD=edapassword
      - EDA_DB_NAME=eda
    ports:
      - "5000:5000"
    depends_on:
      - eda_db_service
      - eda_notebook_service

  eda_redis_service:
    image: redis:latest
    healthcheck:
      test: ["CMD-SHELL", "redis-cli -c ping"]
      timeout: 10s
      retries: 5

networks:
  default:
    driver: bridge