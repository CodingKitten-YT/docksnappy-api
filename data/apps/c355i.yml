version: '3.8'
services:
  lidatube_web:
    image: lidatube/lidatube_web:latest
    container_name: lidatube_web
    ports:
      - "80:80" # HTTP (can be any free port and default is 80)
    environment:
      - TZ=Europe/Madrid  # Set the timezone as per your requirement
    volumes:
      - ./data:/data
      - ./lidatube.ini:/etc/lidatube.ini  # If you have a custom lidatube configuration file
    user: "1001"  # Optional, to map the local user ID to the container

  lidatube_api:
    image: lidatube/lidatube_api:latest
    container_name: lidatube_api
    environment:
      - TZ=Europe/Madrid  # Set the timezone as per your requirement
    volumes:
      - ./data:/data
      - ./lidatube.ini:/etc/lidatube.ini  # If you have a custom lidatube configuration file
    user: "1001"  # Optional, to map the local user ID to the container
    depends_on:
      - lidatube_db

  lidatube_db:
    image: postgres:latest
    container_name: lidatube_db
    environment:
      - POSTGRES_DB=lidatube
      - POSTGRES_USER=lidauser
      - POSTGRES_PASSWORD=lidapass
    volumes:
      - ./data/db:/var/lib/postgresql/data  # Persistent storage for the database
    user: "1001"  # Optional, to map the local user ID to the container

  lidatube_redis:
    image: redis:latest
    container_name: lidatube_redis
    ports:
      - "6379:6379"  # Redis port (default is 6379)
    user: "1001"  # Optional, to map the local user ID to the container

  lidatube_cache_redis:
    image: lidatube/lidatube_api:latest
    container_name: lidatube_cache_redis
    environment:
      - TZ=Europe/Madrid  # Set the timezone as per your requirement
    user: "1001"  # Optional, to map the local user ID to the container
    depends_on:
      - lidatube_redis

networks:
  default:
    driver: bridge

volumes:
  lidatube_data:
    driver: local