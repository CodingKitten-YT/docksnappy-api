version: '3.8'

services:
  openttd:
    image: openTTD/openTTD:latest  # Official openTTD Docker image
    container_name: openTTD  # A name for the service (optional, but recommended)
    command: -set inetprotocol=udp -allowvideo -nodedirlocking  # Start with default settings and disable directory locking to avoid issues with shared drives or NAS
    ports:
      - "9000:9000"  # Port 9000 is the default openTTD server port
      - "12345:12345"  # Port 12345 is the default port for the built-in game server web interface (if enabled)
    volumes:
      - "./openTTD:/data"  # Maps a local directory to the container's data directory for saving games, configurations, etc. Change './openTTD' to your desired local path
      - openTTD:/openTTD  # Persists the OpenTTD game files and configurations within the Docker container (name must match the service name)
    environment:
      TZ: "Europe/London"  # Set the timezone, you can change this to your local timezone
    networks:
      - openTTD_network

  postgres:
    image: postgres:13
    container_name: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data  # Persists the database data
    environment:
      POSTGRES_DB: openTTD  # Database name for OpenTTD
      POSTGRES_USER: openTTD  # Username for the OpenTTD database
      POSTGRES_PASSWORD: verySecretPassword  # Password for the OpenTTD database (change this to a secure password)

networks:
  openTTD_network:
    driver: bridge

volumes:
  openTTD:
  postgres_data: