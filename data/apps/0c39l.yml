version: '3.8'

services:
  web:
    image: odoo:14.0
    depends_on:
      - db
    ports:
      - "8069:8069"
    volumes:
      - type: bind
        source: ./config:/etc/odoo
        target: /etc/odoo
      - type: bind
        source: ./addons:/mnt/extra-addons
        target: /mnt/extra-addons
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=odoo
      - ADDONS_PATH=/mnt/extra-addons
      - ODOO_DATABASE_ADMIN_PASSWD=admin
      - ODOO_DB_HOST=db
      - NOVA_ Hostname=nova.localhost
      - NOVA_IP_ADDRESS=172.18.0.2
      - NOVA_USE_REAL_HSTNAME=True
    command: -c '/etc/odoo/config.py' odoo-bin -d /var/lib/odoo/data

  db:
    image: postgres:13
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=odoo
    volumes:
      - odoo-db:/var/lib/postgresql/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - odoo-web:/var/www/odoo
    depends_on:
      - web
    command: nginx -g 'daemon off;'

  redis:
    image: redis:alpine

volumes:
  odoo-db:
  odoo-web:

networks:
  default:
    driver: bridge