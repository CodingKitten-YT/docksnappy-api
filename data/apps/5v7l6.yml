version: '3.8'
services:
  archivebox:
    image: archivebox/archivebox:dev
    container_name: archivebox
    volumes:
      - ./archivebox.toml:/code/archivebox.toml
      - ~/.local/share/archivebox/:/root/.local/share/archivebox/
      - ./downloads:/root/Downloads
    environment:
      - PATH=/usr/local/bin:/usr/local/sbin:$PATH
      - DISPLAY=${DOCKER_HOST_IP}:0.0
    ports:
      - "8001:8001" # web UI
      - "5000:5000"  # Tor Control Port
      - "9051:9051"  # Tor Socks Proxy Port (if you enable the socks proxy)
    depends_on:
      - tor
    restart: unless-stopped

  tor:
    image: archivebox/tor:dev
    container_name: tor
    volumes:
      - ./archives/tor:/var/lib/tor/archives
    environment:
      - DATA_DIR /var/lib/tor/archives
      - HIDE_AND_CHECK 1
    ports:
      - "9050-9051:9050-9051"  # Tor Socks Proxy Client Port(s)
    depends_on:
      - torsocks
    restart: unless-stopped

  torsocks:
    image: archivebox/torsocks:dev
    container_name: torsocks
    environment:
      - TZ=America/New_York
    volumes:
      - /etc/localtime:/etc/localtime:ro
    restart: unless-stopped

networks:
  default:
    driver: bridge