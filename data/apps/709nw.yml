version: '3.7'

services:
  mainsail_app:
    image: 'mainsailapp/mainsail:stable' # Use the stable tag or any other tag you prefer
    container_name: mainsail
    environment:
      - MS_WEB_SECRET=yoursecretkey # Set your own secret key for security
      - MS_DB_HOST=db                  # Reference the database service
      - MS_DB_USERNAME=user              # Database username
      - MS_DB_PASSWORD=password         # Database password
      - MS_DB_NAME=mainsail             # Database name
      # Uncomment the following line if you're using PostgreSQL with encryption
      # - MS_DB_SSLMODE=require
    ports:
      - "8080:80"                          # Web interface
    depends_on:
      - mainsail_db
    volumes:
      - './config:/code/config'         # Path to your local Mainsail configuration directory
      - './data:/root/.local/share/mainsail' # Path to your local data directory (optional, for data persistence)
    networks:
      - mainsail_network

  mainsail_db:
    image: 'postgres:13'                   # PostgreSQL image version 13
    container_name: mainsail-db
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mainsail
    volumes:
      - './data/db:/var/lib/postgresql/data' # Path to your local database data directory (optional, for data persistence)
    networks:
      - mainsail_network

networks:
  mainsail_network:
    driver: bridge