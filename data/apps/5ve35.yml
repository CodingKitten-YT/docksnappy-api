version: '3.8'

services:
  owntracks:
    image: owntracks/owntracks:latest # Use the official OwnTracks image from Docker Hub
    container_name: owntracks-recorder
    ports:
      - "8080:8080" # Web interface on port 8080 (host:container)
      - "9090:9090" # Web Admin Interface (host:container)
      - "6666:6666" # Local API (host:container, optional but recommended)
    environment:
      TZ: "${TZ}" # Set the timezone if necessary, e.g., "Europe/London"
      OWNTRACKS_SQLITE__DATABASE: "true" # Use SQLite for storage (default)
      JAVA_OPTS: "-Xms256M -Xmx512M" # Initial and max heap size for JVM
      # Uncomment the following line if you want to use a specific version of OwnTracks
      # OWNTRACKS_VERSION: "3.4.0"
    volumes:
      - "./config:/etc/owntracks" # Mount configuration directory from host to container
      - "./owntracks-data:/var/lib/owntracks" # Mount data directory from host to container (for SQLite)
      - "./logs:/var/log/owntracks" # Mount logs directory from host to container (optional but recommended for log retention)
    networks:
      - owntrack_network

  postgresql:
    image: postgres:13 # Use PostgreSQL image version 13
    volumes:
      - "./owntracks-data:/var/lib/postgresql" # Mount data directory from host to container (for OwnTracks data)
    environment:
      POSTGRES_DB: "owntracks"
      POSTGRES_USER: "owntracks"
      POSTGRES_PASSWORD: "${OWNTRACKS_POSTGRES_PASSWORD}" # Set the PostgreSQL password (use an environment variable for security)
    networks:
      - owntrack_network

networks:
  owntrack_network:
    driver: bridge