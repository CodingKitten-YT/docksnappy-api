version: '3.8'

services:
  filestash:
    image: filestar/filestash:latest # Use the latest stable release or specify a particular tag
    container_name: filestash
    ports:
      - "9000:9000" # Expose Filestash's web UI on port 9000 of the host
    volumes:
      - "/path/to/filestash:/data" # Mount a local directory for your files (optional, but recommended)
      - filestash-auth:/root/.config/filestash # Volume for storing authentication tokens
      - filestash-db:/var/lib/filestash # Volume for storing the database
    environment:
      POSTGRES_USER: "filestash"
      POSTGRES_DB: "filestash"
      POSTGRES_PASSWORD: "your_password" # Change this to a secure password
      SECRET_KEY: "a_very_secret_key" # Change this to a secret key for session management
      DEFAULT_USERNAME: "user123"
      DEFAULT_EMAIL: "user@example.com"
    depends_on:
      - db

  db:
    image: postgres:latest
    container_name: filestash_db
    volumes:
      - filestash-db:/var/lib/postgresql # Volume for storing the database data (optional, but recommended)
    environment:
      POSTGRES_USER: "filestash"
      POSTGRES_DB: "filestash"
      POSTGRES_PASSWORD: "your_password" # Same password as above
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U filestash"]
      timeout: 10s
      retries: 5

volumes:
  filestash-auth:
  filestash-db:

networks:
  default:
    driver: bridge