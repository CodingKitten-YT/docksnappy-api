version: '3.7'

services:
  opnform-postgres:
    image: postgres:12
    command: >
      postgres -c 'listen_addresses = any' -F '8.8.8.8'
    volumes:
      - opnform-postgres-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: opnform
      POSTGRES_USER: opnformuser
      POSTGRES_PASSWORD: opnformpassword
    ports:
      - "5432:5432"

  opnform-redis:
    image: redis:6.0
    command: Redis-server --appendonly yes
    volumes:
      - opnform-redis-data:/data

  opnform-backend:
    image: opnform/opnform-backend:latest
    ports:
      - "8081:8080" # HTTP API port
    environment:
      DATABASE_URL: postgres://opnformuser:opnformpassword@opnform-postgres:5432/opnform
      REDIS_URL: redis://opnform-redis:6379/0
      SECRET_KEY: your_secret_key # Replace with your own secret key
      JWT_SECRET: another_secret # Replace with a different secret for JWT
      DEBUG: true # Set to false for production
    depends_on:
      - opnform-postgres
      - opnform-redis

  opnform-frontend:
    image: opnform/opnform-frontend:latest
    ports:
      - "8082:3000" # Web interface port
    environment:
      BACKEND_URL: http://opnform-backend:8080
    depends_on:
      - opnform-backend

volumes:
  opnform-postgres-data:
  opnform-redis-data:

networks:
  default:
    external:
      name: opnform-network # Make sure this matches the network you've created