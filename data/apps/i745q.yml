version: '3.8'
services:
  app:
    image: forgejo/forgejo:latest # Use the official ForgeJo image from Docker Hub
    ports:
      - "80:80" # Map HTTP port 80 on the host to port 80 in the container
    environment:
      FORGEJO_APP_API_KEY: your_api_key # Set your ForgeJo application API key here
      FORGEJO_DB_HOST: db # Reference the database service
      FORGEJO_DB_USERNAME: your_db_user # Your database username
      FORGEJO_DB_PASSWORD: your_db_password # Your database password
      FORGEJO_DB_DATABASE: your_db_name # Your database name
      FORGEJO_SMTP_HOST: smtp # If using SMTP for emails, reference the SMTP service if configured
      FORGEJO_SMTP_PORT: 587 # If using SMTP for emails, set the correct port
      FORGEJO_SMTP_USERNAME: your_smtp_user # Your SMTP username if needed
      FORGEJO_SMTP_PASSWORD: your_smtp_password # Your SMTP password if needed
    volumes:
      - ./app:/var/www/html # Mount your local application directory to the container's application directory
    depends_on:
      - db
      - smtp # Depends on database and SMTP services if configured
    restart: unless-stopped # Ensure the app restarts automatically on failure

  db:
    image: postgres:latest # Use the official PostgreSQL image from Docker Hub
    volumes:
      - ./db:/var/lib/postgresql # Mount your local database directory to the container's database directory
    environment:
      POSTGRES_DB: your_db_name # Your database name
      POSTGRES_USER: your_db_user # Your database username
      POSTGRES_PASSWORD: your_db_password # Your database password
    restart: unless-stopped # Ensure the db restarts automatically on failure

  smtp:
    image: smtplife/smtplife:stable-alpine # Use the official SMTP service image from Docker Hub (example using smtplife)
    environment:
      SMTPLIFE_SMTPSERVER_HOSTNAME: your_email_server # Your email server hostname
      SMTPLIFE_SMTPSERVER_PORT: 587 # Your email server port
      SMTPLIFE_SMTPSERVER_USERNAME: your_smtp_user # Your SMTP username if needed
      SMTPLIFE_SMTPSERVER_PASSWORD: your_smtp_password # Your SMTP password if needed
    ports:
      - "25:25" # Map SMTP port 25 on the host to port 25 in the container (example using smtplife)
    restart: unless-stopped # Ensure the smtp service restarts automatically on failure

networks:
  default:
    driver: bridge