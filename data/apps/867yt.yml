version: '3.8'

services:
  beaver_habit_tracker:
    image: 'beaverhabitracker/beaver-habit-tracker:latest' # Use the official image from Docker Hub
    container_name: beaver_habit_tracker
    ports:
      - "8000:8000" # Expose the default port the app runs on for web access
    restart: unless-stopped
    environment:
      - HOST=0.0.0.0
      - DB_HOST=db  # Reference the database service by its name
      - DB_USER=beaveruser
      - DB_PASSWORD=beaverpass
      - DB_NAME=habittracker
      - SECRET_KEY=mysecretkey  # Use an environment variable or a secret management tool for production
      - DEBUG=True
    volumes:
      - './app:/code'  # Map the local app directory to the container's code directory
      - '/code/static:/var/www/static'  # Map the static files directory (if you have one)
      - '/code/beaver-habit-tracker.db:/var/www/beaver-habit-tracker.db'  # Map the database file if you're using SQLite
    depends_on:
      - db

  db:
    image: 'postgres:13'  # Use the official PostgreSQL image
    container_name: beaver_habit_tracker_db
    environment:
      POSTGRES_USER: beaveruser
      POSTGRES_PASSWORD: beaverpass
      POSTGRES_DB: habittracker
    volumes:
      - './app/db:/var/lib/postgresql/data'  # Persist database data to a local directory
    restart: unless-stopped

# Uncomment the following lines if you need to use Redis (optional)
# redis:
#   image: 'redis:6-alpine'
#   container_name: beaver_habit_tracker_redis
#   restart: unless-stopped

networks:
  default:
    driver: bridge