version: '3.8'

services:
  octoprint:
    image: octoprint/octoprint:latest  # You can also use a specific tag if you prefer
    container_name: octoprint  # Optional, sets a custom name for the OctoPrint service
    ports:
      - "5000:5000"  # Web UI on port 5000
      - "8000:8000"  # TCP API on port 8000 (optional, if you want to access it from the host)
      - "5500:5500"  # Serial port on port 5500 (optional, if you have a TFT screen connected)
    volumes:
      - "${HOME}/.octoprint:/data"  # Persists user data and configuration
      - "/etc/localtime:/etc/localtime"  # Optional, for timezone support
      - "usb_camera:/usr/src/myapp"  # Optional, if you want to share a camera device (e.g., USB webcam)
      - "/dev/ttyUSB0:/dev/ttyUSB0"  # Required, for connecting to your printer via serial
    environment:
      TZ: "Europe/London"  # Set your timezone (optional, overrides auto-detection)
    restart: unless-stopped  # Automatically restart on failure
    networks:
      - octoprint_network  # Optional network configuration

  portainer:
    image: portainer/portainer:latest
    container_name: portainer
    ports:
      - "9000:9000"
    volumes:
      - portainer_data:/data
    networks:
      - octoprint_network

volumes:
  octoprint_data:
  usb_camera:

networks:
  octoprint_network: