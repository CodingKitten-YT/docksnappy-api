version: '3.8'

services:
  immich:
    image: immich/immich:latest  # You can also specify a tag if you want a specific version
    ports:
      - "80:80"  # Expose Immich on port 80 of the host for HTTP access (optional, default is port 8080)
      - "443:443"  # Expose Immich on port 443 of the host for HTTPS access (optional, with a reverse proxy like nginx)
    command: --data-dir /immich/data  # Set the data directory path (default is /var/lib/immich)
    volumes:
      - ./immich-data:/immich/data  # Mount your local Immich data directory to the container (create this directory on the host)
      - ./immich-conf:/immich/conf  # Mount your local Immich configuration directory to the container (create this directory on the host for custom config files)
      - type: bind  # Allow Immich to access the host's files to upload (optional, default is /home/user)
        source: ~/Pictures  # Path to your pictures on the host
        target: /root/.local/share/file-manager/Downloading  # Corresponding path inside the container
    environment:
      - TZ=Europe/Berlin  # Set timezone (adjust to your timezone)
      - JWT_SECRET=change_this_for_production  # A secret key for JWT tokens (change this for security)
    restart: unless-stopped  # Ensure Immich restarts on failure or system reboot

  nginx:
    image: nginx:latest
    ports:
      - "80:80"  # Map HTTP port if you exposed Immich on host port 80
      - "443:443"  # Map HTTPS port if you exposed Immich on host port 443
    volumes:
      - ./immich-nginx/conf.d:/etc/nginx/conf.d  # Custom Nginx configuration (create this directory and add your config files)
    depends_on:
      - immich
    networks:
      - immich_network

networks:
  immich_network:
    driver: bridge