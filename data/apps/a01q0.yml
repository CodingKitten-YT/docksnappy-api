version: '3.7'

services:
  bookstack:
    image: bookstack/bookstack:latest
    container_name: bookstack
    ports:
      - "8080:80" # HTTP on host, port 80 exposed within the container
      - "4439:443" # HTTPS on host (optional, requires SSL)
    environment:
      EMAIL_HOST: mailhog://localhost:1025 # For SMTP integration with MailHog
      EMAIL_PORT: 1025                        # For SMTP integration with MailHog
      EMAIL_USER: postmaster@default            # For SMTP integration with MailHog
      EMAIL_PASSWORD: easypass                   # For SMTP integration with MailHog (optional)
    volumes:
      - "./data:/data"
      - "./uploads:/uploads"
    networks:
      - bookstack-net
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:5.7
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: bookstack
      MYSQL_USER: bookstack
      MYSQL_PASSWORD: bookstackpassword
    volumes:
      - "./db:/var/lib/mysql"
    networks:
      - bookstack-net

  redis:
    image: redis:6.0-alpine
    container_name: redis
    networks:
      - bookstack-net

networks:
  bookstack-net:
    driver: bridge