version: '3.8'

services:
  web:
    image: myip_web:latest  # Replace with the actual image name or tag of your MyIP web application
    ports:
      - "80:80"  # Map HTTP port 80 on the host to port 80 in the container
      - "443:443"  # Map HTTPS port 443 on the host to port 443 in the container if you're using SSL
    depends_on:
      - db
    environment:
      MYIP_SECRET_KEY: "${SECRET_KEY}"  # Environment variable for a secret key, if required by your app
      # Add other environment variables as needed by your application
    volumes:
      - ./web:/var/www/html:ro  # Bind the web directory from your host to the container's web root (read-only)
      - myip_web_data:/var/www/html  # Volume for persistent storage of web application data and files
    networks:
      - myip_network

  db:
    image: mysql:5.7  # Replace with the actual image name or tag you want to use for MySQL
    volumes:
      - myip_db_data:/var/lib/mysql  # Volume for persistent storage of database data
    environment:
      MYSQL_DATABASE: "myip"  # Database name
      MYSQL_USER: "myipuser"  # Database user
      MYSQL_PASSWORD: "myippass"  # Database password
      MYSQL_ROOT_PASSWORD: "rootpassword"  # Root user password for MySQL (optional)
    networks:
      - myip_network

  php:
    image: php:7.4-fpm  # Replace with the actual image name or tag you want to use for PHP-FPM
    volumes:
      - ./web:/var/www/html:rw  # Bind the web directory from your host to the container's web root (read-write)
      - myip_web_data:/var/www/html  # Volume for persistent storage of PHP application data and files
    networks:
      - myip_network

volumes:
  myip_web_data:
  myip_db_data:

networks:
  myip_network: