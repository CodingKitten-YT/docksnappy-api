version: '3.8'
services:
  mikochi-gateway:
    image: mikochi/gateway:latest
    ports:
      - "8081:8080" # HTTP API
    networks:
      - mikochi-network
    environment:
      GATEWAY_HOST: gateway.local

  mikochi-admin-ui:
    image: mikochi/admin-ui:latest
    ports:
      - "8082:3000" # Admin UI
    depends_on:
      - mikochi-gateway
    networks:
      - mikochi-network
    environment:
      ADMIN_UI_HOST: adminui.local

  mikochi-task-ui:
    image: mikochi/task-ui:latest
    ports:
      - "8083:80" # Task UI
    depends_on:
      - mikochi-gateway
    networks:
      - mikochi-network
    environment:
      TASK_UI_HOST: taskui.local

  mikochi-worker:
    image: mikochi/worker:latest
    depends_on:
      - mikochi-gateway
    networks:
      - mikochi-network

  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: mikochi
      POSTGRES_USER: mikochi
      POSTGRES_PASSWORD: change_this_password
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - mikochi-network

volumes:
  postgres-data:
    driver: local

networks:
  mikochi-network:
    driver: bridge