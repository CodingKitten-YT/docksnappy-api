version: '3'
services:
  mafl-libfuzzer:
    image: duncancannon/mafl:latest
    container_name: mafl_libfuzzer
    ports:
      - "8000:8000" # Expose MaFL's built-in server on port 8000 (host to container)
    volumes:
      - ./mafl:/mafl # Mount your local MAFL project directory into the container
      - ${HOME}/libfuzzer_fuzzers:/opt/libfuzzer_fuzzers # Mount a directory with your libFuzzer fuzzers (optional, if you have existing fuzzers)
    environment:
      - MAFL_CONFIG_PATH=/mafl/config.yaml # Path to the MaFL configuration file within the volume
      - MAFL_RESOURCES_PATH=/opt/libfuzzer_fuzzers # Set the resources path where MaFL will look for fuzzers
      # Add any other environment variables required by your MAFL setup
    depends_on:
      - mafl-postgres

  mafl-postgres:
    image: postgres:latest
    container_name: mafl_postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data # Use a named volume for persistent storage of PostgreSQL data
    environment:
      - POSTGRES_DB=mafl # Database name as specified in MaFL's configuration
      - POSTGRES_USER=mafl # Username for the database (change as needed)
      - POSTGRES_PASSWORD=secret # Password for the database (change as needed)

volumes:
  postgres_data:
    driver: local