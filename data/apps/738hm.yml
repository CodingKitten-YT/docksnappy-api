version: '3.7'

services:
  activepieces:
    image: activepieces/activepieces:latest # Use the official Activepieces image from Docker Hub
    ports:
      - "80:4000" # Map HTTP port 80 on the host to port 4000 in the container for public access
      - "8125:8125" # Map websockets port 8125 on the host to port 8125 in the container
    environment:
      - DB_HOST=db
      - DB_NAME=activepieces
      - DB_USER=root
      - DB_PASSWORD=secret
      - DB_DRIVER=mysql
      - AUTH_SECRET=change_this # A secret key for authentication
      - DEBUG=true # Set to false in production
      # Optional environment variables:
      # - LOG_LEVEL=debug|info|warn|error (default is info)
    volumes:
      - ./data:/data # Mount a volume for data persistence, e.g., logs and state
      - ./config:/code/config # Mount a volume for configuration files
    depends_on:
      - db

  db:
    image: postgres:latest
    volumes:
      - postgres_data:/var/lib/postgresql # Use a named volume for data persistence
    environment:
      - POSTGRES_DB=activepieces
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=secret

volumes:
  postgres_data: