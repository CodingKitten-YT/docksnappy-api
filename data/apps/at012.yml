version: '3.8'

services:
  app:
    image: flashpaper/flashpaper:latest
    ports:
      - "5000:5000" # HTTP endpoint exposed to the host, uncomment if needed
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/etc/google-secrets/flashpaper-gce.json # Path to your Google Cloud credentials file
      - SECRET_KEY=your_secret_key # Your Django secret key, this should be a secure random key for production
    volumes:
      - ./data:/data  # Mount the data directory from the host to store Flashpaper files and settings
      - ./flashpaper:/code  # Mount the flashpaper directory from the host to keep local custom code or configurations
    command: gunicorn --workers=4 --bind unix:///run/gunicorn.sock app:app
    depends_on:
      - db

  db:
    image: postgres:13
    volumes:
      - postgres_data:/var/lib/postgresql/data  # Use a named volume to store database data persistently

    environment:
      - POSTGRES_USER=flashuser
      - POSTGRES_PASSWORD=flashpassword
      - POSTGRES_DB=flashpaper_db

volumes:
  postgres_data:

networks:
  default:
    driver: bridge