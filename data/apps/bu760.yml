version: '3.8'

services:
  outline-server:
    image: "outline/outline-server:latest"
    ports:
      - "80:3000" # Expose HTTP on the host, proxy passes to HTTP and HTTPS within the container
      - "443:443" # Expose HTTPS on the host, requires SSL configuration
    environment:
      OUTLINE_MODE: server
      OUTLINE_POSTGRES_HOST: db
      OUTLINE_POSTGRES_DB: outline
      OUTLINE_POSTGRES_USER: outline
      OUTLINE_POSTGRES_PASSWORD: outline
      JWT_SECRET: change_this_unsafe_for_production
    depends_on:
      - db
    volumes:
      - "./data:/data"
      - "./letsencrypt:/etc/letsencrypt"
    networks:
      - outline-network

  postgres:
    image: "postgres:latest"
    environment:
      POSTGRES_DB: outline
      POSTGRES_USER: outline
      POSTGRES_PASSWORD: outline
    volumes:
      - "./data/db:/var/lib/postgresql/data"

networks:
  outline-network:
    driver: bridge