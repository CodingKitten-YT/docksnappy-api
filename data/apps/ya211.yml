version: '3.7'

services:
  gotify:
    image: 'gotify/server:latest'
    command: 'server -config=/code/config.yaml'
    ports:
      - "8080:8080" # HTTP API
      - "3000:3000" # Web UI
    volumes:
      - './data:/data'
      - './letsencrypt:/etc/letsencrypt'
      - './config.yaml:/code/config.yaml'  # Optional: use the default config and skip volume mount for it
    environment:
      GOTIFY_SERVER_HOST: '0.0.0.0'
      GOTIFY_SERVER_PROTOCOL: 'https'
      GOTIFY_SERVER_SSL_YARN_CA_FILE: '/etc/letsencrypt/live/yourdomain.com/fullchain.pem'  # Update with your domain
      GOTIFY_SERVER_SSL_YARN_KEY_FILE: '/etc/letsencrypt/live/yourdomain.com/privkey.pem'   # Update with your domain
      GOTIFY_SERVER_SSL_YARN_TLS_FILE: '/etc/letsencrypt/live/yourdomain.com/cert.pem'    # Update with your domain
    restart: 'unless-stopped'
    networks:
      - gotify_network

  letsencrypt:
    image: 'certbot/certbot'
    volumes:
      - './letsencrypt:/etc/letsencrypt'
      - '/var/lib/docker/volumes/_data/:/etc/letsencrypt/'  # Docker default volume
    command: certonly --standalone --email your-email@example.com --agree-tos --expire 82500 --non-interactive --name yourdomain.com --nginx -d yourdomain.com
    depends_on:
      - gotify
    environment:
      HTTP_PROXY: 'http://your-proxy.example.com:3128'
      HTTPS_PROXY: 'https://your-proxy.example.com:3128'
      NO_PROXY: 'localhost,127.0.0.1,.local'
    networks:
      - gotify_network

networks:
  gotify_network:
    driver: bridge