version: '3.8'
services:
  homegallery:
    image: homegallery/homegallery:latest # Use the official HomeGallery image from Docker Hub
    container_name: homegallery
    ports:
      - "80:80" # Expose HTTP on the host, default HomeGallery port is 80
    environment:
      TZ: "Europe/London" # Set the timezone, change to your desired timezone
    volumes:
      - "./data:/data" # Mount a volume for user data and configuration (optional, for data persistence)
      - "./uploads:/uploads" # Mount a volume for uploaded files (optional, for file persistence)
    restart: unless-stopped # Restart the container if it stops

  nginx-proxy:
    image: 'nginx:latest'
    container_name: nginx-proxy
    ports:
      - "80:80" # Expose HTTP on the host, forward to HomeGallery
      - "443:443" # Expose HTTPS on the host (if using Let's Encrypt or similar)
    volumes:
      - "./letsencrypt:/etc/letsencrypt" # Mount for Let's Encrypt certificates (optional)
      - "nginx-data:/var/lib/nginx" # Volume for Nginx proxy mode (optional)
    command: proxy # Run in proxy mode, reverse proxying to HomeGallery
    depends_on:
      - homegallery
    restart: unless-stopped

  db:
    image: postgres:latest
    container_name: homegallery_db
    environment:
      POSTGRES_DB: homegallery # Database name
      POSTGRES_USER: homegallery # Username
      POSTGRES_PASSWORD: changeit # Password (change 'changeit' to your desired password)
    volumes:
      - "postgres-data:/var/lib/postgresql" # Volume for PostgreSQL data (optional, for database persistence)
    restart: unless-stopped

volumes:
  postgres-data:
  nginx-data: