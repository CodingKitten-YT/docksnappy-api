version: '3.8'

services:
  commafeed-api:
    image: "commafeed/commafeed:latest"
    ports:
      - "5000:5000"
    environment:
      SERVICE_GUNTHER_ENABLED: "true"
      GUNTHER_TOKEN: "some_secret_token"
    command: run --allow-root
    volumes:
      - "./data:/var/lib/commafeed"
      - "./commafeed.db.backup:/backup/commafeed.db.backup"
    depends_on:
      - gunther
    networks:
      - commafeed_net

  gunther:
    image: "commafeed/gunther:latest"
    environment:
      GUNTHER_TOKEN: "another_secret_token"
      GUNTHER_ADMIN_USERNAME: "admin"
      GUNTHER_ADMIN_PASSWORD: "admin_password"
    ports:
      - "8082:8080" # This is the default port for Gunther
    volumes:
      - "./data/gunther:/var/lib/gunther"
      - "./gunther.db.backup:/backup/gunther.db.backup"
    networks:
      - commafeed_net

networks:
  commafeed_net:
    driver: bridge