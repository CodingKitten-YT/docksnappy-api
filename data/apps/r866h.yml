version: '3'

services:
  langfuse-api:
    image: langfuse/langfuse-api:latest
    ports:
      - "5000:5000"
    depends_on:
      - redis

  redis:
    image: redis:6-alpine
    command: rediss-server --appendonly yes
    volumes:
      - "./data/redis:/data/redis"

  nginx-proxy:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "./certs:/etc/nginx/ssl"
      - ./data/nginx/conf.d:./data/nginx/conf.d:ro
      - ./data/nginx/html:./data/nginx/html:ro
      - ./data/nginx/logs:./data/nginx/logs:ro
    depends_on:
      - langfuse-api

  langfuse-worker:
    image: langfuse/langfuse-worker:latest
    volumes:
      - "./data/langfuse-worker:/app/code"
    depends_on:
      - langfuse-api

volumes:
  redis_data:
    driver: local

networks:
  default:
    external:
      name: langfuse-net