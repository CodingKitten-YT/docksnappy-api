version: '3.8'

services:
  gramps:
    image: gramps/gramps-web:latest
    container_name: gramps_web
    ports:
      - "80:5000" # Expose Gramps Web on port 80 of the host
    volumes:
      - ./gramps-data:/var/lib/gramps # Path to your local Gramps data directory
      - ./gramps-media:/srv/gramps/media # Path to your local media files directory (optional)
      - ./gramps-plugins:/usr/share/gramps/plugins # Path to your local plugins directory (optional)
    environment:
      - TZ=Europe/London  # Set the Timezone as needed (e.g., Europe/London, America/New_York)
    restart: unless-stopped # Ensure the container restarts on failure

  postgres:
    image: postgres:13
    volumes:
      - gramps-postgres-data:/var/lib/postgresql
    environment:
      - POSTGRES_DB=gramps
      - POSTGRES_USER=gramps
      - POSTGRES_PASSWORD=secret  # You should change this password to something secure
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U gramps"]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  default:
    driver: bridge

volumes:
  gramps-postgres-data:
    driver: local