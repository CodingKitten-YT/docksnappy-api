version: '3.8'

services:
  xbackbone:
    image: 'xbb/xbackbone:latest' # Use the official or your custom XBackBone image
    ports:
      - "8080:8080" # Expose XBackBone's default port, if needed
    environment:
      - TZ=Europe/London # Set timezone, change to your preferred timezone
      - JWT_SECRET=mySecretKey # A secret key for JWT authentication
      # Additional environment variables specific to your XBackBone setup
    volumes:
      - './xbackbone-data:/data' # Mount a volume for data persistence, if needed
    command: "run" # Start XBackBone in 'run' mode for full initialization

  postgres:
    image: 'postgres:13' # Use the official PostgreSQL image
    environment:
      - POSTGRES_USER=xbackbone
      - POSTGRES_PASSWORD=xbackbonePass
      - POSTGRES_DB=xbackbone
    volumes:
      - './xbackbone-db:/var/lib/postgresql' # Mount a volume for database data persistence

  redis:
    image: 'redis:6' # Use the official Redis image
    ports:
      - "6379:6379"

  celery-beat:
    image: 'xbb/xbackbone-celery-beat:latest' # Use the official or your custom Celery Beat image
    depends_on:
      - xbackbone
    environment:
      - CELERY_BEAT_SCHEDULER=database
      - CELERY_RESULT_BACKEND=redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      # Additional environment variables for Celery Beat
    volumes:
      - './xbackbone-celery-beat-data:/var/lib/celery-beat' # Mount a volume for Celery Beat data persistence

  celery-worker:
    image: 'xbb/xbackbone-celery-worker:latest' # Use the official or your custom Celery Worker image
    depends_on:
      - xbackbone
      - redis
    environment:
      - CELERY_RESULT_BACKEND=redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      # Additional environment variables for Celery Worker
    volumes:
      - './xbackbone-celery-worker-data:/var/lib/celery-worker' # Mount a volume for Celery Worker data persistence

networks:
  default:
    driver: bridge

# Uncomment the following if you want to define custom networks for your services
# networks:
#   xbackbone-net:
#     driver: bridge