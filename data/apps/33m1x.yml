version: '3.8'

services:
  evershop-api:
    image: evershop/evershop-api:latest
    ports:
      - "8000:80"
    depends_on:
      - db
      - redis
      - rabbitmq
      - cache
    environment:
      EVERSHOP_SECRET_KEY: "your_secret_key"
      EVERSHOP_DATABASE_URL: "postgres://db:5432/evershop"
      EVERSHOP_CELERY_RESULT_BACKEND: "redis://redis:6379/0"
      EVERSHOP_CELERY_BROKER_URL: "amqp://rabbitmq:5672/"
      EVERSHOP_CACHES: "{cache:cache, database:database}"
      EVERSHOP_DEFAULT_CURRENCY: "USD"
    volumes:
      - ./data/evershop-api:/code/data

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: db
      POSTGRES_PASSWORD: db
      POSTGRES_DB: evershop
    volumes:
      - evershop-db-data:/var/lib/postgresql/data

  redis:
    image: redis:6-alpine

  rabbitmq:
    image: rabbitmq:3.8-management
    ports:
      - "5672:5672"
      - "15674:15674"

  cache:
    image: redis:6-alpine

volumes:
  evershop-db-data:
  evershop-api-data: